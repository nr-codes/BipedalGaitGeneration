Notebook[{

Cell[CellGroupData[{
Cell["Begin Package", \
"Section",ExpressionUUID->"39e9dbc5-5d7b-4441-82c6-0811eadac5b2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<BipedalLocomotion`Model`\>\"", ",", " ", 
    RowBox[{"{", 
     RowBox[{
     "\"\<GlobalVariables`\>\"", ",", " ", "\"\<RigidBodyDynamics`\>\"", ",", 
      " ", "\"\<BipedalLocomotion`\>\""}], "}"}]}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"2b48c04c-aed4-40f4-8f8c-f7daa783cbb0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Model", \
"Section",ExpressionUUID->"a37a045c-eda3-4c7a-b220-791d1c2a1f8d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"regime", "[", 
    RowBox[{"name_", ",", " ", "data_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "P", ",", " ", "V", ",", " ", "B", ",", " ", "M", ",", " ", "\[Theta]", 
       ",", " ", "Pcon", ",", " ", "n\[Mu]T", ",", " ", "dt", ",", " ", "J", 
       ",", " ", "n", ",", " ", "m", ",", " ", "so\[Theta]", ",", " ", "PT", 
       ",", " ", "Pd", ",", " ", "Vd", ",", " ", "S", ",", " ", "I"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"P", " ", "=", " ", 
       RowBox[{"data", "[", "\"\<P\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"V", " ", "=", " ", 
       RowBox[{"data", "[", "\"\<V\>\"", "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"data", "[", "\"\<B\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"I", " ", "=", " ", 
       RowBox[{"data", "[", "\"\<I\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"M", " ", "=", " ", 
       RowBox[{"data", "[", "\"\<M\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"\[Theta]", " ", "=", " ", 
       RowBox[{"data", "[", "\"\<\[Theta]\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Pcon", " ", "=", " ", 
       RowBox[{"data", "[", "\"\<Pcon\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dt", " ", "=", " ", 
       RowBox[{"data", "[", "\"\<dt\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n\[Mu]T", " ", "=", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<n\[Mu]\>\"", "]"}], " ", "+", " ", 
        RowBox[{"Length", "@", 
         RowBox[{"Select", "[", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "@", "dt"}], ",", " ", 
           RowBox[{
            RowBox[{"#", "\[NotEqual]", " ", "0"}], "&"}]}], "]"}]}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"J", " ", "=", " ", 
       RowBox[{"data", "[", "\"\<J[p]\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"S", " ", "=", " ", 
       RowBox[{"data", "[", "\"\<S\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"stance", " ", "foot", " ", "constraints"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"RBDConQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-p\>\""}], ",", " ", "P"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"virtual", " ", "constraints"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"RBDVirtQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-v\>\""}], ",", " ", "V"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"transmission", " ", "matrix"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"RBDTranV", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-u\>\""}], ",", " ", "B"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "impacts", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"RBDConQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-i\>\""}], ",", " ", "I"}], 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"trajectory", " ", "to", " ", "follow"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{
       "\[Theta]", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"so\[Theta]", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"n", "\[LeftDoubleBracket]", 
           RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], " ", "-", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
            "n", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ",", 
            " ", "0"}], "}"}]}], ")"}], "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"n", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}],
           "-", 
          RowBox[{
          "n", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
         ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PT", " ", "=", " ", 
       RowBox[{"PolynomialTrajectory", "[", 
        RowBox[{"M", ",", " ", "so\[Theta]", ",", " ", 
         RowBox[{"\"\<c\>\"", " ", "\[Rule]", " ", 
          RowBox[{"nx", "+", "1"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Length", "[", "P", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m", " ", "=", " ", 
       RowBox[{"Length", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Pd", " ", "=", " ", 
       RowBox[{"PT", "\[LeftDoubleBracket]", 
        RowBox[{"\"\<\[Eta]d\>\"", ",", " ", 
         RowBox[{"1", ";;", "n"}]}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Vd", " ", "=", " ", 
       RowBox[{"PT", "\[LeftDoubleBracket]", 
        RowBox[{"\"\<\[Eta]d\>\"", ",", " ", 
         RowBox[{
          RowBox[{"n", "+", "1"}], ";;", "m"}]}], "\[RightDoubleBracket]"}]}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"add", " ", "trajectories", " ", "as", " ", "constraints"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"RBDConQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-b\>\""}], ",", " ", 
        RowBox[{"-", "Pd"}], ",", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", 
          RowBox[{"Range", "[", "n", "]"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"RBDVirtQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-b\>\""}], ",", " ", 
        RowBox[{"-", "Vd"}], ",", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", 
          RowBox[{"Range", "[", 
           RowBox[{
            RowBox[{"n", "+", "1"}], ",", " ", "m"}], "]"}]}], "]"}]}], "]"}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"\[Eta]", " ", "constraints"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"w", "/", " ", "no"}], " ", "coefficients"}], ",", " ", 
        RowBox[{"get", " ", 
         RowBox[{"(", 
          RowBox[{"h0", ",", " ", "h0dot"}], ")"}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"RBDConQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]0\>\""}], ",", " ", "P", 
        ",", " ", 
        RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"RBDVirtQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]0\>\""}], ",", " ", "V", 
        ",", " ", 
        RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"RBDConQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]T\>\""}], ",", " ", "P", 
        ",", " ", 
        RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"RBDVirtQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]T\>\""}], ",", " ", "V", 
        ",", " ", 
        RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"w", "/", " ", "coefficients"}], ",", " ", 
        RowBox[{"get", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"h0", "-", "hd"}], ",", " ", 
           RowBox[{"h0dot", "-", "hddot"}]}], ")"}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Length", "[", "P", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"RBDConQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]p\>\""}], ",", " ", "P", 
        ",", " ", 
        RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"RBDConQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]p\>\""}], ",", " ", 
        RowBox[{"-", "Pd"}], ",", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", 
          RowBox[{"Range", "[", "n", "]"}]}], "]"}], ",", " ", 
        RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Length", "@", "V"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"RBDVirtQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]v\>\""}], ",", " ", "V", 
        ",", " ", 
        RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"RBDVirtQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]v\>\""}], ",", " ", 
        RowBox[{"-", "Vd"}], ",", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", 
          RowBox[{"Range", "[", "n", "]"}]}], "]"}], ",", " ", 
        RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"each", " ", "component", " ", "individually"}], ",", " ", 
        RowBox[{"get", " ", 
         RowBox[{"(", 
          RowBox[{"h0", ",", " ", "h0dot"}], ")"}], " ", "or", " ", 
         RowBox[{"(", 
          RowBox[{"hd", ",", " ", "hddot"}], ")"}]}]}], " ", "*)"}], 
      RowBox[{"RBDConQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]a\>\""}], ",", " ", "P", 
        ",", " ", 
        RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"RBDVirtQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]a\>\""}], ",", " ", "V", 
        ",", " ", 
        RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"RBDConQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]d\>\""}], ",", " ", "Pd", 
        ",", " ", 
        RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"RBDVirtQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]d\>\""}], ",", " ", "Vd", 
        ",", " ", 
        RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "slopes", " ", "given", " ", "stance", " ", "and", " ", "swing", " ", 
        "foot", " ", "constraints"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"RBDConQ", "[", 
       RowBox[{
        RowBox[{"name", " ", "<>", " ", "\"\<-\[Sigma]\>\""}], ",", " ", 
        "S"}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "data", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"name", " ", "<>", " ", "\"\<-\>\"", " ", "<>", "  ", "#"}], 
         "&"}], " ", "/@", " ", 
        RowBox[{"{", 
         RowBox[{
         "\"\<p\>\"", ",", " ", "\"\<v\>\"", ",", " ", "\"\<u\>\"", ",", " ", 
          "\"\<b\>\"", ",", " ", "\"\<\[Eta]0\>\"", ",", " ", 
          "\"\<\[Eta]T\>\"", ",", " ", "\"\<\[Eta]p\>\"", ",", " ", 
          "\"\<\[Eta]v\>\""}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
        "\"\<\[Alpha]0\>\"", ",", " ", "\"\<\[Alpha]T\>\"", ",", " ", 
         "\"\<\[Alpha]f\>\""}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m", " ", "=", " ", 
       RowBox[{"<|", 
        RowBox[{"MapThread", "[", 
         RowBox[{"Rule", ",", " ", 
          RowBox[{"{", 
           RowBox[{"m", ",", " ", 
            RowBox[{"Values", "@", 
             RowBox[{"PT", "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "\"\<\[Eta]0\>\"", ",", " ", "\"\<\[Eta]T\>\"", ",", " ", 
                 "\"\<\[Alpha]\>\""}], "}"}], ",", " ", "1"}], 
              "\[RightDoubleBracket]"}]}]}], "}"}]}], "]"}], "|>"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"RBDParameters", "[", 
       RowBox[{"nx", " ", "+", " ", "n\[Mu]T", " ", "+", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"PT", "[", "\"\<c\>\"", "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"<|", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\"\<f\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"n", "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", "4"}], "\[RightDoubleBracket]"}]}], "|>"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<h\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"name", " ", "<>", " ", "\"\<-i\>\""}]}], "|>"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Eta]0\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]0\>\""}]}], "|>"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Eta]T\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]T\>\""}]}], "|>"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Eta]p\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]p\>\""}]}], "|>"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Eta]v\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]v\>\""}]}], "|>"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Eta]a\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]a\>\""}]}], "|>"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Eta]d\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]d\>\""}]}], "|>"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<J[p]\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]p\>\""}]}], "|>"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Sigma]\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"name", " ", "<>", " ", "\"\<-\[Sigma]\>\""}]}], "|>"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<B0\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{
           "n", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], " ", 
           "\[Rule]", " ", 
           RowBox[{"PT", "[", "\"\<B0\>\"", "]"}]}], "|>"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Alpha]0\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{
           "n", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], " ", 
           "\[Rule]", " ", 
           RowBox[{
           "PT", "\[LeftDoubleBracket]", "\"\<\[Eta]0\>\"", 
            "\[RightDoubleBracket]"}]}], "|>"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<BT\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{
           "n", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}], " ", 
           "\[Rule]", " ", 
           RowBox[{"PT", "[", "\"\<BT\>\"", "]"}]}], "|>"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Alpha]T\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{
           "n", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}], " ", 
           "\[Rule]", " ", 
           RowBox[{
           "PT", "\[LeftDoubleBracket]", "\"\<\[Eta]T\>\"", 
            "\[RightDoubleBracket]"}]}], "|>"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Alpha]\[Theta]\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"name", " ", "<>", " ", "\"\<-i\>\""}], " ", "\[Rule]", 
           " ", 
           RowBox[{
           "\[Theta]", "\[LeftDoubleBracket]", "2", 
            "\[RightDoubleBracket]"}]}], "|>"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Alpha]J[p]\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"name", " ", "<>", " ", "\"\<-\[Eta]p\>\""}], " ", 
           "\[Rule]", " ", "J"}], "|>"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Theta]\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"rbdind", "@", 
            RowBox[{"\[Theta]", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", " ", 
              RowBox[{"{", 
               RowBox[{"1", ",", "3", ",", "4"}], "}"}]}], 
             "\[RightDoubleBracket]"}]}]}], "|>"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<t\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", "dt"}], "|>"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<nc\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", "nc"}], "|>"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<np\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"Length", "[", "P", "]"}]}], "|>"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<nv\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"Length", "[", "V", "]"}]}], "|>"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<nu\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"Length", "[", "B", "]"}]}], "|>"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<ni\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", 
           RowBox[{"Length", "[", "I", "]"}]}], "|>"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<P\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{
           "n", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], " ", 
           "\[Rule]", " ", "Pcon"}], "|>"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<\[Alpha]\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", "m"}], "|>"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<M\>\"", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"name", " ", "\[Rule]", " ", "M"}], "|>"}]}]}], 
       "\[IndentingNewLine]", "|>"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"4d2ab6da-f0c0-4056-a30a-f20e5b00d6da"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BLCreateBiped", "[", 
   RowBox[{
   "name_", ",", " ", "C_", ",", " ", "XT_", ",", " ", "draw_", ",", " ", 
    "feet_", ",", " ", 
    RowBox[{"init_:", 
     RowBox[{"<|", "|>"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"c", ",", " ", "x", ",", " ", "A"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"BLbiped", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<name\>\"", " ", "\[Rule]", " ", "name"}], ",", " ", 
          RowBox[{"\"\<draw\>\"", " ", "\[Rule]", " ", "draw"}], ",", " ", 
          RowBox[{"\"\<feet\>\"", " ", "\[Rule]", " ", "feet"}]}], "|>"}], 
        ",", " ", "init"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"c", " ", "=", " ", 
      RowBox[{"KeyValueMap", "[", 
       RowBox[{"regime", ",", " ", "C"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"x", " ", "=", " ", 
      RowBox[{"KeyValueMap", "[", 
       RowBox[{"xT", ",", " ", "XT"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"A", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{"c", ",", " ", "x"}], "]"}], ",", " ", 
        RowBox[{
         RowBox[{"Join", "@@", "#"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"blmfCon", "[", 
      RowBox[{"A", "[", "\"\<f\>\"", "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"blmhCon", "[", 
      RowBox[{"A", "[", "\"\<h\>\"", "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"blmxTCon", "[", 
      RowBox[{"A", "[", "\"\<xT\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"blm\[Eta]0Con", "[", 
      RowBox[{"A", "[", "\"\<\[Eta]0\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blmB0Con", "[", 
      RowBox[{"A", "[", "\"\<B0\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blm\[Alpha]0Con", "[", 
      RowBox[{"A", "[", "\"\<\[Alpha]0\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"blm\[Eta]TCon", "[", 
      RowBox[{"A", "[", "\"\<\[Eta]T\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blmBTCon", "[", 
      RowBox[{"A", "[", "\"\<BT\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blm\[Alpha]TCon", "[", 
      RowBox[{"A", "[", "\"\<\[Alpha]T\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"blm\[Alpha]\[Theta]Con", "[", 
      RowBox[{"A", "[", "\"\<\[Alpha]\[Theta]\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"blm\[Eta]pCon", "[", 
      RowBox[{"A", "[", "\"\<\[Eta]p\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blm\[Eta]vCon", "[", 
      RowBox[{"A", "[", "\"\<\[Eta]v\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"blm\[Eta]aCon", "[", 
      RowBox[{"A", "[", "\"\<\[Eta]a\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blm\[Eta]dCon", "[", 
      RowBox[{"A", "[", "\"\<\[Eta]d\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"blmJpCon", "[", 
      RowBox[{"A", "[", "\"\<J[p]\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blm\[Alpha]JpCon", "[", 
      RowBox[{"A", "[", "\"\<\[Alpha]J[p]\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"blmPCon", "[", 
      RowBox[{"A", "[", "\"\<P\>\"", "]"}], "]"}], ";", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{"blmDTCon", "[", 
      RowBox[{"A", "[", "\"\<t\>\"", "]"}], "]"}], ";", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{"blm\[Sigma]Con", "[", 
      RowBox[{"A", "[", "\"\<\[Sigma]\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blmfootCon", "[", 
      RowBox[{"A", "[", "\"\<\[Sigma]\>\"", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"blmcostCon", "[", 
      RowBox[{"A", "[", "\"\<f\>\"", "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"blmfosimCon", "[", 
      RowBox[{"A", "[", "\"\<f\>\"", "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"blmhosimCon", "[", 
      RowBox[{"A", "[", "\"\<h\>\"", "]"}], "]"}], ";", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"add", " ", "polynomial", " ", "coefficients", " ", "info"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"BLbiped", "[", "\"\<\[Alpha]\>\"", "]"}], " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"A", "[", "\"\<\[Alpha]\>\"", "]"}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"<|", 
             RowBox[{"\"\<M\>\"", " ", "\[Rule]", " ", "#"}], "|>"}], "&"}], 
           " ", "/@", " ", 
           RowBox[{"A", "[", "\"\<M\>\"", "]"}]}]}], "}"}], ",", " ", 
        RowBox[{
         RowBox[{"Join", "@@", "#"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"add", " ", "n"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"c", " ", "=", " ", 
      RowBox[{"A", "\[LeftDoubleBracket]", 
       RowBox[{"{", 
        RowBox[{
        "\"\<np\>\"", ",", " ", "\"\<nv\>\"", ",", " ", "\"\<nu\>\"", ",", 
         " ", "\"\<ni\>\"", ",", " ", "\"\<nc\>\""}], "}"}], 
       "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"c", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"j", " ", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{"i", " ", "\[Rule]", " ", 
           RowBox[{"c", "[", 
            RowBox[{"i", ",", " ", "j"}], "]"}]}], "|>"}]}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", 
          RowBox[{"Keys", "@", "c"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"j", ",", " ", 
          RowBox[{"Keys", "@", 
           RowBox[{"c", "[", "i", "]"}]}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"BLbiped", "[", "\"\<n\>\"", "]"}], " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"Flatten", "@", 
         RowBox[{"{", 
          RowBox[{"c", ",", " ", 
           RowBox[{"C", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", " ", 
             RowBox[{"{", "\"\<n\[Mu]\>\"", "}"}]}], 
            "\[RightDoubleBracket]"}]}], "}"}]}], ",", " ", 
        RowBox[{
         RowBox[{"Join", "@@", "#"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "make", " ", "all", " ", "parameter", " ", "vectors", " ", "the", " ", 
        "same", " ", "length"}], ";", " ", 
       RowBox[{"mma", " ", 
        RowBox[{"restriction", "?"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{"RBDParameters", "[", 
      RowBox[{"Max", "@", 
       RowBox[{"A", "[", "\"\<nc\>\"", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"A", "\[LeftDoubleBracket]", 
       RowBox[{"\"\<nc\>\"", ",", " ", "All"}], "\[RightDoubleBracket]"}], 
      " ", "=", " ", "nc"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "A"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 
 InitializationCell->
  True,ExpressionUUID->"0fa93f29-786a-4cb0-908d-f271b346de9f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section",
 InitializationCell->
  True,ExpressionUUID->"89ca9acb-4053-4b62-ae07-011985e5c6d0"],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\n", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"4658df9e-a842-4ee0-aa85-339f6974490e"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
Evaluator->"Local",
WindowSize->{1247, 1383},
WindowMargins->{{67, Automatic}, {0, Automatic}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
CellContext->"Global`",
TrackCellChangeTimes->False,
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]

