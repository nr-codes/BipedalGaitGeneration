Notebook[{

Cell[CellGroupData[{
Cell["TO DO", \
"Section",ExpressionUUID->"1820cd00-5a4a-4b18-832b-9ad8b6359c1f"],

Cell["\<\
need to expand options in BLPlotProjection from Projection to include options \
to FixAngles, probably should make FixAngles a global function\
\>", "Text",ExpressionUUID->"3fa7116c-70f2-4244-878f-1fa822c0fa70"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Begin Package", \
"Section",ExpressionUUID->"b07d7787-6827-4aed-ad8f-671de1d4f225"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<BipedalLocomotion`\>\"", ",", " ", 
    RowBox[{"{", 
     RowBox[{
     "\"\<GlobalVariables`\>\"", ",", " ", "\"\<RigidBodyDynamics`\>\"", ",", 
      " ", "\"\<HybridDynamics`\>\"", ",", " ", 
      "\"\<BipedalLocomotion`Model`\>\"", ",", " ", "\"\<MaTeX`\>\""}], 
     "}"}]}], "]"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tol", " ", "=", " ", 
    RowBox[{"10", "^", 
     RowBox[{"-", "5"}]}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "minimum", " ", "distance", " ", "between", " ", "two", " ", "links"}], 
   " ", "*)"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lc", " ", "=", " ", "Gray"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"default", " ", "link", " ", "color"}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"jc", " ", "=", " ", "White"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sc", " ", "=", " ", 
   RowBox[{"{", "Black", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fc", " ", "=", " ", 
    RowBox[{"{", "LightGray", "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ground", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"z6", ",", " ", 
      RowBox[{"I6", "\[LeftDoubleBracket]", 
       RowBox[{"mm", "+", "1"}], "\[RightDoubleBracket]"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"widths", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"0.01", ",", " ", "0.01", ",", " ", "0.01"}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"r", " ", "=", " ", "0.025"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"joint", " ", "radius"}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"axes", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ignorejoint", " ", "=", " ", 
    RowBox[{"ignorelink", " ", "=", " ", 
     RowBox[{"ignore", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"Root", ",", " ", "\"\<\[Theta]\>\""}], "}"}]}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"poi", " ", "=", " ", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"scale", " ", "=", " ", "1"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"paths", " ", "=", " ", 
    RowBox[{"<|", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\"\<Local\>\"", " ", "\[Rule]", " ", 
       RowBox[{"DirectoryName", "@", "$InputFileName"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
      "\"\<Figures\>\"", " ", "\[Rule]", " ", "\"\<../../../Figures\>\""}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
      "\"\<JSON\>\"", " ", "\[Rule]", " ", 
       "\"\<../../../GaitBrowser/src/bipeds\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
      "\"\<Images\>\"", " ", "\[Rule]", " ", 
       "\"\<../../../GaitBrowser/app/imgs\>\""}], ",", "\[IndentingNewLine]", 
      
      RowBox[{"\"\<Here\>\"", " ", "\[RuleDelayed]", "  ", 
       RowBox[{"StringReplace", "[", 
        RowBox[{
         RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
         RowBox[{
          RowBox[{"___", "~~", "\"\<Models\>\""}], " ", "\[Rule]", " ", 
          "\"\<../../../Models\>\""}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "|>"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLPath", "[", 
     RowBox[{"where_", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "path", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"path", " ", "=", " ", 
        RowBox[{"Lookup", "[", 
         RowBox[{"paths", ",", " ", "where", ",", " ", "$Failed"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"paths", "[", "\"\<Local\>\"", "]"}], ",", "path", ",", " ",
           "n"}], "}"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLExportTo", "[", 
     RowBox[{"where_", ",", " ", "n_", ",", " ", "d_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"BLPath", "[", 
       RowBox[{"where", ",", " ", "n"}], "]"}], ",", " ", "d", ",", "opts"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLImportFrom", "[", 
     RowBox[{"where_", ",", " ", "n_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Import", "[", 
     RowBox[{
      RowBox[{"BLPath", "[", 
       RowBox[{"where", ",", " ", "n"}], "]"}], ",", " ", "opts"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Attributes", "[", "BLSaveTo", "]"}], " ", "=", " ", 
   RowBox[{"{", "HoldRest", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLSaveTo", "[", 
     RowBox[{"where_", ",", " ", "n_", ",", " ", "d_"}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"Save", "[", 
     RowBox[{
      RowBox[{"BLPath", "[", 
       RowBox[{"where", ",", " ", "n"}], "]"}], ",", " ", "d"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLGetFrom", "[", 
     RowBox[{"where_", ",", " ", "n_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Get", "[", 
     RowBox[{
      RowBox[{"BLPath", "[", 
       RowBox[{"where", ",", " ", "n"}], "]"}], ",", " ", "opts"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"IEEETran", "/", "LaTex"}], " ", "info"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"BLLaTex", " ", "=", " ", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<text width\>\"", " ", "\[Rule]", " ", "485.1"}], ",", " ", 
       RowBox[{"\"\<text height\>\"", " ", "\[Rule]", " ", "696.0"}], ",", 
       " ", 
       RowBox[{"\"\<column width\>\"", " ", "\[Rule]", " ", "236.55"}], ",", 
       " ", 
       RowBox[{"\"\<image height\>\"", " ", "\[Rule]", " ", "500"}]}], 
      "|>"}]}], ";"}], "*)"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLLaTex", " ", "=", " ", 
    RowBox[{"<|", 
     RowBox[{
      RowBox[{"\"\<text width\>\"", " ", "\[Rule]", " ", "516"}], ",", " ", 
      RowBox[{"\"\<text height\>\"", " ", "\[Rule]", " ", "696"}], ",", " ", 
      RowBox[{"\"\<column width\>\"", " ", "\[Rule]", " ", "252"}], ",", " ", 
      
      RowBox[{"\"\<image height\>\"", " ", "\[Rule]", " ", "500"}]}], 
     "|>"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLTeX", "[", 
    RowBox[{"e_", ",", " ", 
     RowBox[{"m_:", "5"}], ",", " ", 
     RowBox[{"pre_:", "\"\<\>\""}]}], "]"}], " ", ":=", " ", 
   RowBox[{"MaTeX", "[", 
    RowBox[{"e", ",", " ", 
     RowBox[{"Magnification", "\[Rule]", "m"}], ",", " ", 
     RowBox[{"\"\<Preamble\>\"", " ", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
       "\"\<\\\\usepackage{\>\"", "<>", " ", "pre", " ", "<>", " ", 
        "\"\<,color,siunitx}\>\""}], "}"}]}]}], "]"}]}], ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"93ec1d1d-810e-4a6c-bcb4-da22adfc4187"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Set Drawing Parameters", \
"Section",ExpressionUUID->"fc88b6ae-c881-42c3-a8ce-1bb488318583"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLWidth", "[", "w_", "]"}], " ", ":=", " ", 
    RowBox[{"widths", " ", "=", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"VectorQ", "@", "w"}], ",", " ", 
       RowBox[{"w", "\[LeftDoubleBracket]", 
        RowBox[{"1", ";;", "3"}], "\[RightDoubleBracket]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"w", ",", " ", "w", ",", " ", "w"}], "}"}]}], "]"}]}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLRadius", "[", "w_", "]"}], " ", ":=", " ", 
    RowBox[{"r", " ", "=", " ", "w"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLLinkColor", "[", "c_", "]"}], " ", ":=", " ", 
    RowBox[{"lc", " ", "=", " ", "c"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLJointColor", "[", "c_", "]"}], " ", ":=", " ", 
    RowBox[{"jc", " ", "=", " ", "c"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLAxes", "[", "c_", "]"}], " ", ":=", " ", 
    RowBox[{"axes", " ", "=", " ", "c"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLScaleLengths", "[", 
     RowBox[{"n_:", "1"}], "]"}], " ", ":=", " ", 
    RowBox[{"scale", " ", "=", " ", "n"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLDontDraw", "[", 
    RowBox[{
     RowBox[{"lname_:", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"jname_:", 
      RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ignorelink", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Join", "[", 
         RowBox[{"ignore", ",", " ", 
          RowBox[{"Flatten", "@", 
           RowBox[{"{", "lname", "}"}]}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ignorejoint", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Join", "[", 
         RowBox[{"ignore", ",", " ", 
          RowBox[{"Flatten", "@", 
           RowBox[{"{", "jname", "}"}]}]}], "]"}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->"In[278]:=",ExpressionUUID->"5e69507d-2b9c-499e-92c6-b7872f9540ac"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Draw Biped", \
"Section",ExpressionUUID->"33a201b4-c07a-455d-9634-2130ee09356c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Link", "[", 
     RowBox[{"p_", ",", " ", "c_", ",", " ", "color_", ",", " ", "axes_"}], 
     "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "wl", ",", " ", "wu", ",", " ", "u", ",", " ", "v", ",", " ", "l", ",",
         " ", "m", ",", " ", "R", ",", " ", "C", ",", " ", "A"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"Length", "@", "p"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v", " ", "=", " ", 
        RowBox[{"c", " ", "-", " ", "p"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"l", " ", "=", " ", 
        RowBox[{"Norm", "[", "v", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"u", " ", "=", " ", 
        RowBox[{"PadLeft", "[", 
         RowBox[{
          RowBox[{"{", "l", "}"}], ",", " ", "m"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"set", " ", "rectangular", " ", "bounding", " ", "box"}], " ",
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"wl", " ", "=", " ", 
        RowBox[{"-", 
         RowBox[{
         "widths", "\[LeftDoubleBracket]", "axes", 
          "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wl", "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], " ", "=", " ", "0"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"wu", " ", "=", " ", 
        RowBox[{
        "widths", "\[LeftDoubleBracket]", "axes", "\[RightDoubleBracket]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"wu", "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], " ", "=", " ", "l"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "ignore", " ", "\"\<RotationMatrix vectors do not define a plane\>\"",
          " ", "warning"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"R", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"PossibleZeroQ", "[", "l", "]"}], ",", " ", 
          "\[IndentingNewLine]", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", " ", 
            RowBox[{"{", 
             RowBox[{"m", ",", " ", "m"}], "}"}]}], "]"}], ",", " ", 
          "\[IndentingNewLine]", 
          RowBox[{"Quiet", "[", 
           RowBox[{
            RowBox[{"RotationMatrix", "[", 
             RowBox[{"{", 
              RowBox[{"u", ",", " ", "v"}], "}"}], "]"}], ",", " ", 
            RowBox[{"RotationMatrix", "::", "spln"}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"C", " ", "=", " ", 
        RowBox[{"Cuboid", "[", 
         RowBox[{"wl", ",", " ", "wu"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"A", " ", "=", " ", 
        RowBox[{"AffineTransform", "[", 
         RowBox[{"{", 
          RowBox[{"R", ",", " ", "p"}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"EdgeForm", "[", 
          RowBox[{"{", 
           RowBox[{"Thick", ",", " ", "Black"}], "}"}], "]"}], ",", " ", 
         "color", ",", " ", "Thick", ",", " ", 
         RowBox[{"GeometricTransformation", "[", 
          RowBox[{"C", ",", " ", "A"}], "]"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Joint", "[", 
     RowBox[{"pos_", ",", " ", "color_"}], "]"}], " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"EdgeForm", "[", 
       RowBox[{"{", 
        RowBox[{"Thick", ",", " ", "Black"}], "}"}], "]"}], ",", " ", "color",
       ",", " ", 
      RowBox[{"Ball", "[", 
       RowBox[{"pos", ",", " ", "r"}], "]"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "DrawFlatGround", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<axes\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"Lookup", "[", 
        RowBox[{
         RowBox[{"BLbiped", "[", 
          RowBox[{"\"\<draw\>\"", ",", " ", "\"\<axes\>\""}], "]"}], ",", " ",
          "axes"}], "]"}]}], ",", " ", 
      RowBox[{"\"\<g\>\"", " ", "\[Rule]", " ", "True"}], ",", " ", 
      RowBox[{"\"\<o\>\"", " ", "\[Rule]", " ", "z3"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DrawFlatGround", "[", 
     RowBox[{"OptionsPattern", "[", "]"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"g", ",", " ", "o"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<g\>\"", "]"}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "origin", " ", "is", " ", "assumed", " ", "to", " ", "be", " ", "in",
           " ", "axes", " ", "order"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"o", " ", "=", " ", 
          RowBox[{"OptionValue", "[", "\"\<o\>\"", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "@", 
             RowBox[{"OptionValue", "[", "\"\<axes\>\"", "]"}]}], " ", 
            "\[Equal]", " ", "2"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"o", " ", "=", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"o", "+", "#"}], "&"}], " ", "/@", " ", 
              RowBox[{"ground", "\[LeftDoubleBracket]", 
               RowBox[{"All", ",", " ", 
                RowBox[{"4", ";;", "5"}]}], "\[RightDoubleBracket]"}]}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Join", "[", 
             RowBox[{"sc", 
              RowBox[{"(*", "fc", "*)"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{"InfiniteLine", "[", "o", "]"}], "}"}]}], "]"}]}], ",",
            "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "else", " ", "flat", " ", "ground", " ", "is", " ", "3", "D"}], 
            " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"{", "}"}]}], "\[IndentingNewLine]", "]"}]}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"{", "}"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PiecewiseLinearSurface", "[", 
     RowBox[{"\[CurlyPhi]_", ",", " ", "d_", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "ax", ",", " ", "p", ",", " ", "g", ",", " ", "n", ",", " ", "pts", 
        ",", " ", "ends", ",", " ", "mids"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ax", " ", "=", " ", 
        RowBox[{"mm", " ", "+", " ", 
         RowBox[{"Lookup", "[", 
          RowBox[{"d", ",", " ", "\"\<axes\>\"", ",", " ", "axes"}], 
          "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"n", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "1", "}"}], ",", "1", ",", " ", "All"}], "}"}]}], ";", 
       " ", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "should", " ", "generalize", " ", "to", " ", "take", " ", "all", " ",
           "possible", " ", "slopes"}], ",", " ", 
         RowBox[{
         "or", " ", "use", " ", "opts", " ", "to", " ", "select", " ", 
          "specific", " ", "slopes"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"OptionValue", "[", "\"\<\[Sigma][i]\>\"", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"n", " ", "===", " ", "Automatic"}], ",", " ", 
           RowBox[{"n", " ", "=", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", "1", "}"}], ",", "1", ",", " ", "All"}], "}"}]}]}],
           "]"}], ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"BLGetFootFalls", "[", "\[CurlyPhi]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"p", " ", "===", " ", 
          RowBox[{"{", "}"}]}], ",", " ", 
         RowBox[{"Return", "[", 
          RowBox[{"{", "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"p", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"Sequence", "@@", "n"}], ",", " ", "ax"}], 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"p", "/", 
         RowBox[{"Lookup", "[", 
          RowBox[{"d", ",", " ", "\"\<scale\>\"", ",", " ", "scale"}], 
          "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"pts", " ", "=", " ", 
        RowBox[{"Join", "@@", "p"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"n", " ", "=", " ", 
        RowBox[{"Length", "@", "pts"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ends", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"n", " ", ">", " ", "2"}], ",", " ", 
          RowBox[{"HalfLine", " ", "/@", " ", 
           RowBox[{"pts", "\[LeftDoubleBracket]", 
            RowBox[{"{", 
             RowBox[{"1", ",", " ", 
              RowBox[{"-", "1"}]}], "}"}], "\[RightDoubleBracket]"}]}], ",", 
          " ", 
          RowBox[{"List", "@", 
           RowBox[{"InfiniteLine", "@", "pts"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mids", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"n", " ", ">", " ", "3"}], ",", " ", 
          RowBox[{"Line", " ", "/@", " ", 
           RowBox[{"pts", "\[LeftDoubleBracket]", 
            RowBox[{"2", ";;", 
             RowBox[{"-", "2"}]}], "\[RightDoubleBracket]"}]}], ",", " ", 
          RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Join", "[", 
        RowBox[{"fc", ",", " ", 
         RowBox[{"{", 
          RowBox[{"InfiniteLine", "[", "g", "]"}], "}"}], ",", " ", "sc", ",",
          " ", "ends", ",", " ", "mids"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "OneSurface", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<m\>\"", " ", "\[RuleDelayed]", " ", 
      RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}]}], ",", " ", 
     RowBox[{"\"\<g\>\"", " ", "\[Rule]", " ", "True"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OneSurface", "[", 
     RowBox[{"\[CurlyPhi]_", ",", " ", "d_", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "m", ",", " ", "n", ",", " ", "\[Sigma]", ",", " ", "x", ",", " ", "c",
         ",", " ", "ax", ",", " ", "p", ",", " ", "g"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ax", " ", "=", " ", 
        RowBox[{"mm", " ", "+", " ", 
         RowBox[{"Lookup", "[", 
          RowBox[{"d", ",", " ", "\"\<axes\>\"", ",", " ", "axes"}], 
          "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"n", " ", "=", " ", 
        RowBox[{"Lookup", "[", 
         RowBox[{"d", ",", " ", "\"\<\[Sigma]\>\"", ",", " ", "Automatic"}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"compute", " ", "slope"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"c", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"AssociationQ", "[", "\[CurlyPhi]", "]"}], ",", "  ", 
          RowBox[{
           RowBox[{"\[CurlyPhi]", "[", "\"\<c[t]\>\"", "]"}], "[", "0", "]"}],
           ",", " ", "\[CurlyPhi]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"c", " ", "=", " ", 
        RowBox[{"devec", "[", 
         RowBox[{"c", ",", " ", "nc"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"c", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", 
          RowBox[{"1", ";;", "nx"}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"get", " ", "post"}], "-", 
         RowBox[{"impact", " ", "m"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<m\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"m", " ", "=", " ", 
          RowBox[{"BLSide", "[", 
           RowBox[{"m", ",", " ", "Automatic", ",", " ", "2"}], "]"}]}], 
         ";"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"BLbiped", "[", "\"\<m\>\"", "]"}], "[", "m", "]"}], "[", 
         RowBox[{"x", ",", " ", "c"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Sigma]", " ", "=", " ", 
        RowBox[{
         RowBox[{"BLbiped", "[", 
          RowBox[{"\"\<\[Sigma]\>\"", ",", " ", "m"}], "]"}], "[", 
         RowBox[{"x", ",", " ", "c"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Sigma]", " ", "=", " ", 
        RowBox[{"\[Sigma]", "\[LeftDoubleBracket]", 
         RowBox[{"1", ";;", "mm"}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"get", " ", 
         RowBox[{"(", 
          RowBox[{"post", "-", "impact"}], ")"}], " ", "stance", " ", "foot", 
         " ", "location"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"BLbiped", "[", 
           RowBox[{"\"\<\[Eta]a\>\"", ",", " ", "m"}], "]"}], "[", 
          RowBox[{"x", ",", " ", "c"}], "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"ax", " ", "-", " ", "mm"}], "\[RightDoubleBracket]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"p", "/", 
         RowBox[{"Lookup", "[", 
          RowBox[{"d", ",", " ", "\"\<scale\>\"", ",", " ", "scale"}], 
          "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"g", " ", "=", " ", 
        RowBox[{"DrawFlatGround", "[", 
         RowBox[{
          RowBox[{"\"\<o\>\"", " ", "\[Rule]", " ", "p"}], ",", " ", 
          RowBox[{"\"\<g\>\"", "\[Rule]", " ", 
           RowBox[{"OptionValue", "[", "\"\<g\>\"", "]"}]}], ",", " ", 
          RowBox[{"\"\<axes\>\"", " ", "\[Rule]", " ", "ax"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "ax", "]"}], " ", "\[Equal]", " ", "2"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", " ", "===", " ", "Automatic"}], ",", " ", 
            RowBox[{
             RowBox[{"n", " ", "=", " ", 
              RowBox[{
               RowBox[{"First", "@", 
                RowBox[{"Complement", "[", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{
                    RowBox[{"mm", "+", "1"}], ",", " ", "nm"}], "]"}], ",", 
                  "  ", "ax"}], "]"}]}], "-", "mm"}]}], ";"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Sigma]", " ", "=", " ", 
           RowBox[{
           "\[Sigma]", "\[LeftDoubleBracket]", "n", 
            "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Join", "[", 
           RowBox[{"g", ",", " ", 
            RowBox[{"{", 
             RowBox[{"sc", ",", " ", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{"p", ",", " ", 
                RowBox[{
                 RowBox[{"RotationMatrix", "[", "\[Sigma]", "]"}], ".", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", " ", "0"}], "}"}]}]}], "]"}]}], "}"}]}], 
           "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"else", " ", "biped", " ", "is", " ", "3", "D"}], " ", 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", " ", "===", " ", "Automatic"}], ",", " ", 
            RowBox[{
             RowBox[{"n", " ", "=", " ", "ax"}], ";"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"n", " ", "=", " ", 
           RowBox[{"n", " ", "-", " ", "mm"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Sigma]", " ", "=", " ", 
           RowBox[{
           "\[Sigma]", "\[LeftDoubleBracket]", "n", 
            "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"x", " ", "=", " ", 
           RowBox[{"IdentityMatrix", "[", "mm", "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"sc", ",", " ", 
            RowBox[{"InfinitePlane", "[", 
             RowBox[{"p", ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"RotationMatrix", "[", 
                  RowBox[{
                   RowBox[{
                   "\[Sigma]", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], ",", " ", 
                   RowBox[{"-", 
                    RowBox[{
                    "x", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}]}], "]"}], ".", 
                 RowBox[{
                 "x", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}]}], ",", " ", 
                RowBox[{
                 RowBox[{"RotationMatrix", "[", 
                  RowBox[{
                   RowBox[{
                   "\[Sigma]", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], ",", " ", 
                   RowBox[{
                   "x", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}], "]"}], ".", 
                 RowBox[{
                 "x", "\[LeftDoubleBracket]", "2", 
                  "\[RightDoubleBracket]"}]}]}], "}"}]}], "]"}]}], "}"}]}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLWalkingSurface", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<b\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"Lookup", "[", 
        RowBox[{"BLbiped", ",", " ", "\"\<draw\>\"", ",", " ", 
         RowBox[{"<|", "|>"}]}], "]"}]}], ",", " ", 
      RowBox[{"\"\<\[Sigma][i]\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", 
      " ", 
      RowBox[{"SurfaceData", " ", "\[Rule]", " ", "OneSurface"}], ",", " ", 
      RowBox[{"\"\<g\>\"", " ", "\[Rule]", " ", "True"}], ",", " ", 
      RowBox[{"\"\<SurfaceDataOptions\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLWalkingSurface", "[", 
    RowBox[{"\[CurlyPhi]_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "x", ",", " ", "c", ",", " ", "f", ",", " ", "d", ",", " ", "g", ",", 
       " ", "ax", ",", " ", "\[Sigma]"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"\[CurlyPhi]", " ", "===", " ", "None"}], ",", " ", 
        RowBox[{"Return", "[", 
         RowBox[{"{", "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"d", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<b\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ax", " ", "=", " ", 
       RowBox[{"mm", " ", "+", " ", 
        RowBox[{"Lookup", "[", 
         RowBox[{"d", ",", " ", "\"\<axes\>\"", ",", " ", "axes"}], "]"}]}]}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "ax"}], " ", "\[Equal]", " ", "2"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OptionValue", "[", "SurfaceData", "]"}], "[", 
         RowBox[{"\[CurlyPhi]", ",", " ", "d", ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<SurfaceDataOptions\>\"", "]"}]}], 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OptionValue", "[", "SurfaceData", "]"}], "[", 
         RowBox[{"\[CurlyPhi]", ",", " ", "d", ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<SurfaceDataOptions\>\"", "]"}]}], 
         "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[285]:=",ExpressionUUID->"da0f07e5-9343-408a-bff2-5759ece12e09"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "LinkPositions", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"\"\<b\>\"", " ", "\[RuleDelayed]", " ", 
      RowBox[{"Lookup", "[", 
       RowBox[{"BLbiped", ",", " ", "\"\<draw\>\"", ",", " ", 
        RowBox[{"<|", "|>"}]}], "]"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LinkPositions", "[", 
   RowBox[{"x_", ",", " ", "c_", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "a", ",", " ", "b", ",", " ", "d", ",", " ", "X", ",", " ", "L", ",", 
      " ", "f", ",", " ", "pos", ",", " ", "ax"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"a", " ", "=", " ", 
      RowBox[{
       RowBox[{"Flatten", "[", "x", "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"1", ";;", "nx"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"b", " ", "=", " ", 
      RowBox[{
       RowBox[{"Flatten", "[", "c", "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"1", ";;", "nc"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"d", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "\"\<b\>\"", "]"}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{"extract", " ", "draw", " ", "options"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "get", " ", "position", " ", "of", " ", "link", " ", "in", " ", "world",
        " ", "frame"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"X", " ", "=", " ", 
      RowBox[{"XL0fun", "[", 
       RowBox[{"a", ",", " ", "b"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"L", " ", "=", " ", 
      RowBox[{"RBDGetLinkInfo", "[", "\"\<p\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"f", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"RBDSpatialPosition", "[", 
         RowBox[{"X", ",", " ", "z3", ",", " ", "#", ",", " ", 
          RowBox[{"\"\<x\>\"", " ", "\[Rule]", " ", "a"}], ",", " ", 
          RowBox[{"\"\<\[Lambda]\>\"", " ", "\[Rule]", " ", "b"}]}], "]"}], 
        "\[LeftDoubleBracket]", 
        RowBox[{"4", ";;", "6"}], "\[RightDoubleBracket]"}], "&"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pos", " ", "=", " ", 
      RowBox[{"<|", "|>"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pos", "[", "k", "]"}], " ", "=", " ", 
        RowBox[{"f", "[", "k", "]"}]}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"k", ",", " ", 
         RowBox[{"Keys", "@", "L"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pos", "[", "Root", "]"}], " ", "=", " ", "z3"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"add", " ", "POIs"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ax", " ", "=", " ", 
      RowBox[{"Lookup", "[", 
       RowBox[{"d", ",", " ", "\"\<poi\>\"", ",", " ", 
        RowBox[{"<|", "|>"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"f", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"RBDSpatialPosition", "[", 
         RowBox[{"X", ",", " ", "#3", ",", " ", "#1"}], "]"}], 
        "\[LeftDoubleBracket]", 
        RowBox[{"4", ";;", "6"}], "\[RightDoubleBracket]"}], "&"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"L", "[", "k", "]"}], " ", "=", " ", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[DoubleStruckB]", " ", "=", " ", 
             RowBox[{"#1", "&"}]}], "}"}], ",", " ", 
           RowBox[{"ax", "[", "k", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"pos", "[", "k", "]"}], " ", "=", " ", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[DoubleStruckB]", " ", "=", " ", "f"}], "}"}], ",", " ", 
           RowBox[{"ax", "[", "k", "]"}]}], "]"}]}], ";"}], ",", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"k", ",", " ", 
         RowBox[{"Keys", "@", "ax"}]}], "}"}]}], "\[IndentingNewLine]", "]"}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "hack", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"pos", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", " ", "/.", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"\[DoubleStruckX]", "[", "i_", "]"}], " ", 
            "\[RuleDelayed]", " ", 
            RowBox[{
            "a", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
           ",", " ", 
           RowBox[{
            RowBox[{"\[DoubleStruckC]", "[", "i_", "]"}], " ", 
            "\[RuleDelayed]", " ", 
            RowBox[{
            "b", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}], 
          "}"}]}], "&"}], " ", "/@", " ", "pos"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "scale", " ", "model", " ", "and", " ", "get", " ", "axes", " ", "to", 
       " ", "draw", " ", "on"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ax", " ", "=", " ", 
      RowBox[{"Lookup", "[", 
       RowBox[{"d", ",", " ", "\"\<axes\>\"", ",", " ", "axes"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"pos", " ", "=", " ", 
      RowBox[{"pos", "/", 
       RowBox[{"Lookup", "[", 
        RowBox[{"d", ",", " ", "\"\<scale\>\"", ",", " ", "scale"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pos", " ", "=", " ", 
      RowBox[{"pos", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", " ", "ax"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"pos", ",", " ", "L"}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[294]:=",ExpressionUUID->"096ec56f-966c-4447-9a81-c289deb0136b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BLWrap", "[", 
    RowBox[{"f_", ",", " ", "c_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "C", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"C", " ", "=", " ", 
       RowBox[{"BLc", "[", 
        RowBox[{
         RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}], ",", " ", "c"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", "[", 
       RowBox[{
        RowBox[{"C", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", 
          RowBox[{"1", ";;", "nx"}]}], "\[RightDoubleBracket]"}], ",", " ", 
        "C", ",", " ", "opts"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[296]:=",ExpressionUUID->"7dd0b128-8957-46b7-a463-60f58d1e4c3b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLDrawBiped", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Graphics", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<b\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"Lookup", "[", 
        RowBox[{"BLbiped", ",", " ", "\"\<draw\>\"", ",", " ", 
         RowBox[{"<|", "|>"}]}], "]"}]}], ",", " ", 
      RowBox[{"\"\<\[CurlyPhi]\>\"", " ", "\[Rule]", " ", "None"}], ",", " ", 
      
      RowBox[{"BLWalkingSurface", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLDrawBiped", "[", 
    RowBox[{"x_", ",", " ", "c_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ax", ",", " ", "a", ",", " ", "b", ",", " ", "d", ",", " ", "X", ",", 
       " ", "L", ",", " ", "J", ",", " ", "f", ",", " ", "pos", ",", " ", 
       "\[Sigma]"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"d", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<b\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"extract", " ", "draw", " ", "options"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"ax", " ", "=", " ", 
       RowBox[{"Lookup", "[", 
        RowBox[{"d", ",", " ", "\"\<axes\>\"", ",", " ", "axes"}], "]"}]}], 
      ";", 
      RowBox[{"(*", " ", 
       RowBox[{"get", " ", "axes", " ", "to", " ", "draw", " ", "on"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", " ", "L"}], "}"}], " ", "=", " ", 
       RowBox[{"LinkPositions", "[", 
        RowBox[{"x", ",", " ", "c", ",", " ", 
         RowBox[{"\"\<b\>\"", " ", "\[Rule]", " ", "d"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"get", " ", "lengths"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"a", " ", "=", " ", 
       RowBox[{"Association", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", " ", "\[Rule]", " ", 
           RowBox[{"Norm", "[", 
            RowBox[{
             RowBox[{"pos", "[", "#", "]"}], "-", 
             RowBox[{"pos", "[", 
              RowBox[{"L", "@", "#"}], "]"}]}], "]"}]}], "&"}], " ", "/@", 
         " ", 
         RowBox[{"Keys", "@", "L"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"get", " ", "graphics", " ", "of", " ", "links"}], " ", "*)"}],
       "\[IndentingNewLine]", 
      RowBox[{"b", " ", "=", " ", 
       RowBox[{"Lookup", "[", 
        RowBox[{"d", ",", " ", "\"\<lc\>\"", ",", " ", 
         RowBox[{"<|", "|>"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{
        RowBox[{"#1", " ", "\[Rule]", " ", 
         RowBox[{"Link", "[", 
          RowBox[{
           RowBox[{"pos", "[", "#2", "]"}], ",", " ", 
           RowBox[{"pos", "[", "#1", "]"}], ",", " ", 
           RowBox[{"Lookup", "[", 
            RowBox[{"b", ",", " ", "#1", ",", " ", "lc"}], "]"}], ",", " ", 
           "ax"}], "]"}]}], "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"L", " ", "=", " ", 
       RowBox[{"KeyValueMap", "[", 
        RowBox[{"f", ",", " ", "L"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "drop", " ", "unwanted", " ", "links", " ", "and", " ", "joints"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"L", "[", "#", "]"}], " ", "===", " ", "Root"}], " ", "||", 
         " ", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"ignorelink", ",", " ", "#"}], "]"}], "||", 
         RowBox[{
          RowBox[{"a", "[", "#", "]"}], " ", "\[LessEqual]", " ", "tol"}]}], 
        "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"a", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"Keys", "@", "L"}], ",", " ", "f"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"L", " ", "=", " ", 
       RowBox[{"Values", "@", 
        RowBox[{"KeyDrop", "[", 
         RowBox[{"L", ",", " ", "a"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"b", " ", "=", " ", 
       RowBox[{"Lookup", "[", 
        RowBox[{"d", ",", " ", "\"\<jc\>\"", ",", " ", 
         RowBox[{"<|", "|>"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"a", " ", "=", " ", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"RBDGetLinkNames", "[", "]"}], ",", " ", "ignorejoint"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"J", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Joint", "[", 
          RowBox[{
           RowBox[{"pos", "[", "#", "]"}], ",", " ", 
           RowBox[{"Lookup", "[", 
            RowBox[{"b", ",", " ", "#", ",", " ", "jc"}], "]"}]}], "]"}], 
         "&"}], " ", "/@", " ", "a"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"draw", " ", "slope"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Sigma]", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[CurlyPhi]\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Sigma]", " ", "=", " ", 
       RowBox[{"BLWalkingSurface", "[", 
        RowBox[{"\[Sigma]", ",", " ", 
         RowBox[{"OptionValue", "[", "BLWalkingSurface", "]"}], ",", " ", 
         RowBox[{"\"\<b\>\"", " ", "\[Rule]", " ", "d"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Lookup", "[", 
        RowBox[{"d", ",", " ", "\"\<f\>\"", ",", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"{", "}"}], "&"}], ")"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"X", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"\[Sigma]", ",", " ", "L", ",", " ", "J", ",", " ", 
         RowBox[{"f", "[", 
          RowBox[{"x", ",", " ", "c"}], "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "ax"}], " ", "\[Equal]", " ", "2"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Graphics", "[", 
         RowBox[{"X", ",", " ", 
          RowBox[{"OptionValue", "[", "Graphics", "]"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Graphics3D", "[", 
         RowBox[{"X", ",", " ", 
          RowBox[{"OptionValue", "[", "Graphics", "]"}], ",", " ", 
          RowBox[{"Lighting", "\[Rule]", "\"\<Neutral\>\""}], ",", " ", 
          RowBox[{"Boxed", "\[Rule]", "False"}]}], "]"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"8520fc03-a8f5-426f-8dfe-64f6e4b34c76"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "BLDrawAxes", "]"}], " ", "=", " ", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\"\<axlen\>\"", " ", "\[Rule]", "  ", 
       RowBox[{"1", "/", "8"}]}], "}"}], ",", " ", 
     RowBox[{"Options", "[", "BLDrawBiped", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLDrawAxes", "[", 
    RowBox[{"x_", ",", " ", "c_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", " ", "l", ",", " ", "A", ",", " ", "T", ",", " ", "C"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"RBDGetLinkNames", "[", "]"}], ",", " ", "ignorelink"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"l", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<axlen\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"T", " ", "=", " ", 
       RowBox[{"StringTemplate", "[", "\"\<``-axis-``\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"C", " ", "=", " ", 
       RowBox[{
        RowBox[{"Switch", "[", 
         RowBox[{
         "#2", ",", " ", "4", ",", " ", "Red", ",", " ", "5", ",", " ", 
          "Green", ",", " ", "6", ",", " ", "Blue"}], "]"}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"A", " ", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", "##", "]"}], " ", "\[Rule]", " ", 
           RowBox[{"\[DoubleStruckB]", "[", 
            RowBox[{"#1", ",", " ", 
             RowBox[{"{", 
              RowBox[{"4", ",", " ", "5", ",", " ", "6"}], "}"}], ",", " ", 
             RowBox[{"l", " ", 
              RowBox[{
              "I6", "\[LeftDoubleBracket]", "#2", 
               "\[RightDoubleBracket]"}]}]}], "]"}]}], ",", " ", 
          RowBox[{
           RowBox[{"T", "[", "##", "]"}], " ", "\[Rule]", " ", 
           RowBox[{"C", "[", "##", "]"}]}]}], "}"}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"A", " ", "=", " ", 
       RowBox[{"Join", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"A", "[", 
           RowBox[{"k", ",", " ", "r"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "  ", "n"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"r", ",", 
            RowBox[{"{", 
             RowBox[{"4", ",", "5", ",", "6"}], "}"}]}], "}"}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"T", " ", "=", " ", 
       RowBox[{"Association", "@", 
        RowBox[{"Flatten", "@", 
         RowBox[{"A", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"C", " ", "=", " ", 
       RowBox[{"Association", "@", 
        RowBox[{"Flatten", "@", 
         RowBox[{"A", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", " ", "2"}], "\[RightDoubleBracket]"}]}]}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"A", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<b\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"A", "[", "\"\<poi\>\"", "]"}], " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Lookup", "[", 
          RowBox[{"A", ",", " ", "\"\<poi\>\"", ",", " ", 
           RowBox[{"<|", "|>"}]}], "]"}], ",", " ", "T"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"A", "[", "\"\<lc\>\"", "]"}], " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Lookup", "[", 
          RowBox[{"A", ",", " ", "\"\<lc\>\"", ",", " ", 
           RowBox[{"<|", "|>"}]}], "]"}], ",", " ", "C"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"BLDrawBiped", "[", 
       RowBox[{"x", ",", " ", "c", ",", " ", 
        RowBox[{"\"\<b\>\"", " ", "\[Rule]", " ", "A"}], ",", " ", "opts"}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"fe08394e-bdee-4cde-a92d-87a38631a073"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLDrawCOM", "]"}], " ", "=", " ", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<r\>\"", " ", "\[Rule]", "  ", 
        RowBox[{"1", "/", "8"}]}], "}"}], ",", " ", 
      RowBox[{"Options", "[", "BLDrawBiped", "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLDrawCOM", "[", 
    RowBox[{"x_", ",", " ", "c_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", " ", "L", ",", " ", "A", ",", " ", "T", ",", " ", "C"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"RBDGetLinkNames", "[", "]"}], ",", " ", "ignorelink"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"L", " ", "=", " ", 
       RowBox[{
        RowBox[{"RBDGetLinkInfo", "[", "\"\<inertia\>\"", "]"}], 
        "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", 
         RowBox[{"5", ";;", "7"}]}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"T", " ", "=", " ", 
       RowBox[{"StringTemplate", "[", "\"\<``-com-``\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"C", " ", "=", " ", 
       RowBox[{"Yellow", "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"A", " ", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"T", "[", "##", "]"}], " ", "\[Rule]", " ", 
           RowBox[{"\[DoubleStruckB]", "[", 
            RowBox[{"#1", ",", " ", 
             RowBox[{"{", 
              RowBox[{"4", ",", " ", "5", ",", " ", "6"}], "}"}], ",", " ", 
             RowBox[{"L", "[", "#1", "]"}]}], "]"}]}], ",", " ", 
          RowBox[{
           RowBox[{"T", "[", "##", "]"}], " ", "\[Rule]", " ", 
           RowBox[{"C", "[", "##", "]"}]}]}], "}"}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"A", " ", "=", " ", 
       RowBox[{"Join", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"A", "[", 
           RowBox[{"k", ",", " ", "r"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "  ", "n"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"r", ",", 
            RowBox[{"{", "4", "}"}]}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"T", " ", "=", " ", 
       RowBox[{"Association", "@", 
        RowBox[{"Flatten", "@", 
         RowBox[{"A", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"C", " ", "=", " ", 
       RowBox[{"Association", "@", 
        RowBox[{"Flatten", "@", 
         RowBox[{"A", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", " ", "2"}], "\[RightDoubleBracket]"}]}]}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"A", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<b\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"A", "[", "\"\<poi\>\"", "]"}], " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Lookup", "[", 
          RowBox[{"A", ",", " ", "\"\<poi\>\"", ",", " ", 
           RowBox[{"<|", "|>"}]}], "]"}], ",", " ", "T"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"A", "[", "\"\<lc\>\"", "]"}], " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Lookup", "[", 
          RowBox[{"A", ",", " ", "\"\<lc\>\"", ",", " ", 
           RowBox[{"<|", "|>"}]}], "]"}], ",", " ", "C"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"BLDrawBiped", "[", 
       RowBox[{"x", ",", " ", "c", ",", " ", 
        RowBox[{"\"\<b\>\"", " ", "\[Rule]", " ", "A"}], ",", " ", "opts"}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[301]:=",ExpressionUUID->"4a7fc853-0d0e-4cbb-81fb-4a16e25a339a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"BLAddPOI", ",", " ", "Listable"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLAddPOI", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<J\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", " ", 
      RowBox[{"\"\<C\>\"", " ", "\[Rule]", " ", "Automatic"}]}], "}"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLAddPOI", "[", 
     RowBox[{"name_", ",", " ", "len_", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "n", ",", " ", "l", ",", " ", "A", ",", " ", "T", ",", " ", "C"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<J\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", " ", "===", " ", "Automatic"}], ",", " ", 
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"BLValues", "[", 
           RowBox[{"\"\<\>\"", ",", " ", "\"\<r\>\""}], "]"}]}]}], "]"}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"match", " ", 
         RowBox[{"\[DoubleStruckQ]", "[", 
          RowBox[{"name", ",", " ", 
           RowBox[{"dof", "-", "as", "-", "string"}]}], "]"}], " ", "to", " ",
          "dof", " ", "axis"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"C", " ", "=", " ", 
        RowBox[{
         RowBox[{"Switch", "[", 
          RowBox[{"#2", ",", " ", 
           RowBox[{"\"\<px\>\"", "|", "\"\<rx\>\""}], ",", " ", "4", ",", " ", 
           RowBox[{"\"\<py\>\"", "|", "\"\<ry\>\""}], ",", " ", "5", ",", " ", 
           RowBox[{"\"\<pz\>\"", "|", "\"\<rz\>\""}], ",", " ", "6"}], "]"}], 
         "&"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"n", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Sequence", "@@", "#1"}], ",", " ", 
            RowBox[{"C", "@@", "#1"}]}], "}"}], "&"}], " ", "/@", " ", 
         "n"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"naming", " ", "convention"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"T", " ", "=", " ", 
        RowBox[{"\"\<``-``-\>\"", "<>", " ", "name"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"T", " ", "=", " ", 
        RowBox[{"StringTemplate", "[", "T", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"match", " ", "dof", " ", "axis", " ", "to", " ", "color"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"C", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<C\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"C", " ", "===", " ", "Automatic"}], ",", " ", 
         RowBox[{"C", " ", "=", " ", 
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{
            "#3", ",", " ", "4", ",", " ", "Blue", ",", " ", "5", ",", " ", 
             "Red", ",", " ", "6", ",", " ", "Green"}], "]"}], "&"}]}]}], 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"put", " ", "name", " ", "into", " ", 
         RowBox[{"\[DoubleStruckB]", "[", "...", "]"}], " ", "and", " ", 
         "name", " ", "to", " ", "color"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"A", " ", "=", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"T", "[", "##", "]"}], " ", "\[Rule]", " ", 
            RowBox[{"\[DoubleStruckB]", "[", 
             RowBox[{"#1", ",", " ", 
              RowBox[{"{", 
               RowBox[{"4", ",", " ", "5", ",", " ", "6"}], "}"}], ",", " ", 
              RowBox[{"len", " ", 
               RowBox[{
               "I6", "\[LeftDoubleBracket]", "#3", 
                "\[RightDoubleBracket]"}]}]}], "]"}]}], ",", " ", 
           RowBox[{
            RowBox[{"T", "[", "##", "]"}], " ", "\[Rule]", " ", 
            RowBox[{"C", "[", "##", "]"}]}]}], "}"}], "&"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"A", " ", "=", " ", 
        RowBox[{"MapThread", "[", 
         RowBox[{"A", ",", 
          RowBox[{"n", "\[Transpose]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"T", " ", "=", " ", 
        RowBox[{"Association", "@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"A", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"C", " ", "=", " ", 
        RowBox[{"Association", "@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"A", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", " ", "2"}], "\[RightDoubleBracket]"}]}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"<|", 
        RowBox[{
         RowBox[{"\"\<poi\>\"", " ", "\[Rule]", " ", "T"}], ",", " ", 
         RowBox[{"\"\<lc\>\"", " ", "\[Rule]", " ", "C"}]}], "|>"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLDrawJoints", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<len\>\"", " ", "\[Rule]", "  ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "1"}], "/", "64"}], ",", " ", 
         RowBox[{"1", "/", "64"}], ",", " ", 
         RowBox[{"1", "/", "28"}]}], "}"}]}], ",", " ", 
      RowBox[{"BLAddPOI", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<b\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"Lookup", "[", 
        RowBox[{"BLbiped", ",", " ", "\"\<draw\>\"", ",", " ", 
         RowBox[{"<|", "|>"}]}], "]"}]}], ",", " ", 
      RowBox[{"\"\<L\>\"", " ", "\[Rule]", " ", "0.0075"}], ",", " ", 
      RowBox[{"\"\<A\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "0.01", "}"}]}], ",", " ", 
      RowBox[{"\"\<C\>\"", " ", "\[Rule]", " ", "0.03"}], ",", " ", 
      RowBox[{"Graphics", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<O\>\"", " ", "\[Rule]", " ", 
       RowBox[{"1", "/", "28"}]}], ",", " ", 
      RowBox[{"AxesOrigin", " ", "\[Rule]", " ", "Automatic"}]}], "}"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLDrawJoints", "[", 
    RowBox[{"x_", ",", " ", "c_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "A", ",", " ", "B", ",", " ", "O", ",", " ", "pos", ",", " ", "L", ",", 
       " ", "dof", ",", " ", "lnks", ",", " ", "ax", ",", " ", "cyl", ",", 
       " ", "o", ",", " ", "d"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"get", " ", "draw", " ", "settings"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"A", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<b\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"add", " ", "POI"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"OptionValue", "[", 
        RowBox[{"{", 
         RowBox[{"\"\<len\>\"", ",", " ", "BLAddPOI"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"B", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
       " ", "=", " ", 
       RowBox[{"Sequence", "@@", 
        RowBox[{
        "B", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"BLAddPOI", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "\"\<cyl-b\>\"", ",", " ", "\"\<cyl-f\>\"", ",", " ", 
           "\"\<axis\>\""}], "}"}], ",", " ", 
         RowBox[{"Sequence", "@@", "B"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"Merge", "[", 
        RowBox[{"B", ",", " ", 
         RowBox[{
          RowBox[{"Join", "@@", "#"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"O", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<O\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"O", " ", "=", " ", 
       RowBox[{"BLAddPOI", "[", 
        RowBox[{"\"\<origin\>\"", ",", " ", "O", ",", " ", 
         RowBox[{"\"\<J\>\"", " ", "\[Rule]", " ", 
          RowBox[{"BLValues", "[", 
           RowBox[{
            RowBox[{"BLGetBipedBase", "[", "]"}], ",", " ", "\"\<p\>\""}], 
           "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"get", " ", "pos"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"A", "[", "\"\<poi\>\"", "]"}], " ", "=", " ", 
       RowBox[{"Join", "@@", 
        RowBox[{"Lookup", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"A", ",", " ", "B", ",", " ", "O"}], "}"}], ",", " ", 
          "\"\<poi\>\"", ",", " ", 
          RowBox[{"<|", "|>"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"A", "[", "\"\<lc\>\"", "]"}], " ", "=", " ", 
       RowBox[{"Join", "@@", 
        RowBox[{"Lookup", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"A", ",", " ", "B", ",", " ", "O"}], "}"}], ",", " ", 
          "\"\<lc\>\"", ",", " ", 
          RowBox[{"<|", "|>"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", " ", "L"}], "}"}], " ", "=", " ", 
       RowBox[{"LinkPositions", "[", 
        RowBox[{"x", ",", " ", "c", ",", " ", 
         RowBox[{"\"\<b\>\"", " ", "\[Rule]", " ", "A"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"add", " ", "links"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"dof", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"ignorelink", ",", " ", 
         RowBox[{"{", 
          RowBox[{"\"\<axis\>\"", ",", " ", "\"\<cyl\>\""}], "}"}]}], "]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"dof", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{"dof", ",", " ", "StringQ"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dof", " ", "=", " ", 
       RowBox[{"KeySelect", "[", 
        RowBox[{"L", ",", " ", 
         RowBox[{
          RowBox[{"StringFreeQ", "[", 
           RowBox[{"#", ",", " ", "dof"}], "]"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"Thickness", "[", 
        RowBox[{"OptionValue", "[", "\"\<L\>\"", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"lnks", " ", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"B", ",", " ", 
          RowBox[{"Lookup", "[", 
           RowBox[{
            RowBox[{"A", "[", "\"\<lc\>\"", "]"}], ",", " ", "#1", ",", " ", 
            "lc"}], "]"}], ",", " ", 
          RowBox[{"Line", "[", 
           RowBox[{"pos", " ", "/@", " ", 
            RowBox[{"Reverse", "@", 
             RowBox[{"{", "##", "}"}]}]}], "]"}]}], "}"}], "&"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"lnks", " ", "=", " ", 
       RowBox[{"KeyValueMap", "[", 
        RowBox[{"lnks", ",", " ", "dof"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"add", " ", "arrows"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"dof", " ", "=", " ", "\"\<axis\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dof", " ", "=", " ", 
       RowBox[{"KeySelect", "[", 
        RowBox[{"L", ",", " ", 
         RowBox[{
          RowBox[{"StringContainsQ", "[", 
           RowBox[{"#", ",", " ", "dof"}], "]"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<A\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Thickness", "[", 
          RowBox[{"B", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           "]"}], ",", " ", 
         RowBox[{"Arrowheads", "[", 
          RowBox[{"B", "\[LeftDoubleBracket]", 
           RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ax", " ", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"B", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           ",", " ", 
          RowBox[{"B", "\[LeftDoubleBracket]", 
           RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], ",", " ", 
          RowBox[{"A", "[", 
           RowBox[{"\"\<lc\>\"", ",", " ", "#1"}], "]"}], ",", " ", 
          RowBox[{"Arrow", "[", 
           RowBox[{"pos", " ", "/@", " ", 
            RowBox[{"Reverse", "@", 
             RowBox[{"{", "##", "}"}]}]}], "]"}]}], "}"}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ax", " ", "=", " ", 
       RowBox[{"KeyValueMap", "[", 
        RowBox[{"ax", ",", " ", "dof"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"add", " ", "cylinders"}], " ", "*)"}], "\[IndentingNewLine]", 
      
      RowBox[{"dof", " ", "=", " ", "\"\<cyl-b\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dof", " ", "=", " ", 
       RowBox[{"KeySelect", "[", 
        RowBox[{"L", ",", " ", 
         RowBox[{
          RowBox[{"StringContainsQ", "[", 
           RowBox[{"#", ",", " ", "dof"}], "]"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dof", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#1", ",", " ", 
           RowBox[{
            RowBox[{"StringPart", "[", 
             RowBox[{"#1", ",", 
              RowBox[{";;", 
               RowBox[{"-", "2"}]}]}], "]"}], " ", "<>", " ", "\"\<f\>\""}]}],
           "}"}], "&"}], " ", "/@", " ", 
        RowBox[{"Keys", "@", "dof"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<C\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cyl", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Cylinder", "[", 
           RowBox[{
            RowBox[{"pos", " ", "/@", " ", "#"}], ",", " ", "B"}], "]"}], 
          "}"}], "&"}], " ", "/@", " ", "dof"}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"add", " ", "world", " ", "frame"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"d", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "AxesOrigin", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"d", " ", "=!=", " ", "False"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"dof", " ", "=", " ", "\"\<origin\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dof", " ", "=", " ", 
          RowBox[{"KeySelect", "[", 
           RowBox[{"L", ",", " ", 
            RowBox[{
             RowBox[{"StringContainsQ", "[", 
              RowBox[{"#", ",", " ", "dof"}], "]"}], "&"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"d", " ", "===", " ", "Automatic"}], ",", " ", 
           RowBox[{"d", " ", "=", " ", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", " ", "0", ",", " ", 
               RowBox[{"#", "\[LeftDoubleBracket]", 
                RowBox[{"1", ",", " ", "3"}], "\[RightDoubleBracket]"}]}], 
              "}"}], "&"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"B", " ", "=", " ", 
          RowBox[{"OptionValue", "[", "\"\<A\>\"", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"B", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Thickness", "[", 
             RowBox[{
             "B", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             "]"}], ",", " ", 
            RowBox[{"Arrowheads", "[", 
             RowBox[{"B", "\[LeftDoubleBracket]", 
              RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "]"}]}], "}"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"O", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "\[LeftDoubleBracket]", 
             RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], "-", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"d", "@", "#"}], ",", " ", "2"}], "]"}]}], "&"}]}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"o", " ", "=", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "B", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",",
              " ", 
             RowBox[{"B", "\[LeftDoubleBracket]", 
              RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], ",", " ", 
             RowBox[{"A", "[", 
              RowBox[{"\"\<lc\>\"", ",", " ", "#1"}], "]"}], ",", " ", 
             RowBox[{"Arrow", "@", 
              RowBox[{"O", "[", 
               RowBox[{"pos", " ", "/@", " ", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"{", "##", "}"}]}]}], "]"}]}]}], "}"}], "&"}]}], ";",
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"o", " ", "=", " ", 
          RowBox[{"KeyValueMap", "[", 
           RowBox[{"o", ",", " ", "dof"}], "]"}]}], ";"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"o", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Graphics3D", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"lnks", ",", " ", "cyl", ",", " ", "ax", ",", " ", "o"}], 
         "}"}], ",", " ", 
        RowBox[{"OptionValue", "[", "Graphics", "]"}], ",", " ", 
        RowBox[{"ImageSize", "\[Rule]", 
         RowBox[{"BLLaTex", "[", "\"\<text width\>\"", "]"}]}], ",", " ", 
        RowBox[{"Boxed", "\[Rule]", "False"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->"In[303]:=",ExpressionUUID->"0b1cc9e9-c7c8-467c-ae21-188e75a9645f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Animate", \
"Section",ExpressionUUID->"91686825-73a1-40f8-be4b-bb6adb227328"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLSim", "[", 
     RowBox[{"p_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"BLSim", "[", 
     RowBox[{
      RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}], ",", " ", "p", ",", " ", 
      "opts"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLSim", "[", 
    RowBox[{"m_String", ",", " ", "p_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"BLMap", "[", 
    RowBox[{
     RowBox[{"Sequence", "@@", 
      RowBox[{"BLmxcp", "[", 
       RowBox[{"m", ",", " ", "p"}], "]"}]}], ",", " ", "opts"}], "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[308]:=",ExpressionUUID->"59066b35-2e6f-4b66-b381-6346ea838312"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLAnimateBiped", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"BLDrawBiped", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"Animate", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"BLSim", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<\[CurlyPhi]\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", 
      " ", 
      RowBox[{"\"\<f\>\"", " ", "\[Rule]", " ", "Automatic"}]}], "}"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLAnimateBiped", "[", 
    RowBox[{
     RowBox[{"c_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"VectorQ", "[", 
         RowBox[{"#", ",", " ", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"BLAnimateBiped", "[", 
    RowBox[{
     RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}], ",", " ", "c", ",", " ", 
     "opts"}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLAnimateBiped", "[", 
    RowBox[{"m_String", ",", " ", "c_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"BLAnimateBiped", "[", 
    RowBox[{
     RowBox[{"BLSim", "[", 
      RowBox[{"m", ",", " ", "c", ",", " ", 
       RowBox[{"OptionValue", "[", "BLSim", "]"}]}], "]"}], ",", " ", 
     "opts"}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLAnimateBiped", "[", 
    RowBox[{"\[CurlyPhi]_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "x", ",", " ", "c", ",", " ", "T", ",", " ", "\[Sigma]", ",", " ", "o", 
       ",", " ", "f"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x", " ", "=", " ", 
       RowBox[{
       "\[CurlyPhi]", "\[LeftDoubleBracket]", "1", 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"c", " ", "=", " ", 
       RowBox[{
       "\[CurlyPhi]", "\[LeftDoubleBracket]", "2", 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T", " ", "=", " ", 
       RowBox[{"Flatten", "@", 
        RowBox[{"x", "[", "\"\<Domain\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Sigma]", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[CurlyPhi]\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"\[Sigma]", " ", "===", " ", "Automatic"}], ",", " ", 
        RowBox[{
         RowBox[{"\[Sigma]", " ", "=", " ", "\[CurlyPhi]"}], ";"}]}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<f\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"f", " ", "===", " ", "Automatic"}], ",", " ", 
        RowBox[{
         RowBox[{"f", " ", "=", " ", "BLDrawBiped"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"compute", " ", "a", " ", "bounding", " ", 
        RowBox[{"box", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"o", " ", "=", " ", 
       RowBox[{"Association", "@", 
        RowBox[{"OptionValue", "[", "BLDrawBiped", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"KeyFreeQ", "[", 
          RowBox[{"o", ",", " ", "Graphics"}], "]"}], " ", "||", " ", 
         RowBox[{
          RowBox[{"Lookup", "[", 
           RowBox[{
            RowBox[{"o", "[", "Graphics", "]"}], ",", " ", "PlotRange", ",", 
            " ", "Automatic"}], "]"}], " ", "===", " ", "Automatic"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"o", "[", "Graphics", "]"}], " ", "=", " ", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Lookup", "[", 
              RowBox[{"o", ",", " ", "Graphics", ",", " ", 
               RowBox[{"{", "}"}]}], "]"}], ",", " ", 
             RowBox[{"PlotRange", " ", "\[Rule]", " ", 
              RowBox[{"BLBoundingBox", "[", "\[CurlyPhi]", "]"}]}]}], "}"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"o", " ", "=", " ", 
       RowBox[{"Normal", "@", "o"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Animate", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{
          RowBox[{"x", "[", "t", "]"}], ",", " ", 
          RowBox[{"c", "[", "t", "]"}], ",", " ", "o", ",", " ", 
          RowBox[{"\"\<\[CurlyPhi]\>\"", " ", "\[Rule]", " ", "\[Sigma]"}]}], 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"t", ",", " ", 
          RowBox[{"T", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           ",", " ", 
          RowBox[{
          "T", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
         "}"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{"Evaluate", "@", 
         RowBox[{"OptionValue", "[", "Animate", "]"}]}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"33538e80-6c20-4b82-99cc-5da64730cc59"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Animate Kinematics Only", \
"Section",ExpressionUUID->"7af25095-5040-4680-b6eb-8981e254f844"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"xAt", "[", 
     RowBox[{
      RowBox[{"x_", "?", "VectorQ"}], ",", " ", "M_", ",", " ", "n_"}], "]"}],
     " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\[CurlyPhi]", ",", " ", "T", ",", " ", "A", ",", " ", "p", ",", " ", 
        "b", ",", " ", "r", ",", " ", "p0", ",", " ", "pT", ",", " ", "d"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"T", " ", "=", " ", 
        RowBox[{
         RowBox[{"M", "[", "\"\<T\>\"", "]"}], "\[LeftDoubleBracket]", "2", 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[CurlyPhi]", " ", "=", " ", 
        RowBox[{"M", "[", "\"\<x[t]\>\"", "]"}]}], ";", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"floating", "-", 
         RowBox[{"base", " ", "offset"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"BLIndices", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<\[Theta]\>\"", ",", " ", 
            RowBox[{"BLGetBipedBase", "[", "]"}]}], "}"}], ",", " ", 
          "\"\<p\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p0", " ", "=", " ", 
        RowBox[{
         RowBox[{"\[CurlyPhi]", "[", "0", "]"}], "\[LeftDoubleBracket]", "p", 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"pT", " ", "=", " ", 
        RowBox[{
         RowBox[{"\[CurlyPhi]", "[", "T", "]"}], "\[LeftDoubleBracket]", "p", 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"d", " ", "=", " ", "p"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "positions", " ", "to", " ", "offset", " ", "by", " ", "multiples", 
         " ", "of", " ", "n"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"A", " ", "=", " ", 
        RowBox[{"BLbiped", "[", "\"\<A\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"r", " ", "=", " ", 
        RowBox[{"Diagonal", "[", 
         RowBox[{"A", "\[LeftDoubleBracket]", 
          RowBox[{"p", " ", ",", "p"}], "\[RightDoubleBracket]"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"Pick", "[", 
         RowBox[{"p", ",", " ", "r", ",", " ", 
          RowBox[{"_", "?", "Positive"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"get", " ", "out"}], "-", "of", "-", 
         RowBox[{"plane", " ", "axis"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"d", " ", "=", " ", 
        RowBox[{"Complement", "[", 
         RowBox[{"d", ",", " ", "p"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"EvenQ", "[", "n", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"x", " ", "at", " ", "step", " ", "n"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"b", " ", "=", " ", 
           RowBox[{"PadRight", "[", 
            RowBox[{
             RowBox[{"pT", "-", "p0"}], ",", " ", "nx"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "b", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}], " ", 
           "=", " ", 
           RowBox[{"n", " ", 
            RowBox[{
            "b", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}]}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "b", "\[LeftDoubleBracket]", "d", "\[RightDoubleBracket]"}], " ", 
           "=", " ", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"x", " ", "+", " ", "b"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"b", " ", "=", " ", 
           RowBox[{"PadRight", "[", 
            RowBox[{
             RowBox[{"pT", "-", 
              RowBox[{"r", " ", "p0"}]}], ",", " ", "nx"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "b", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}], " ", 
           "=", " ", 
           RowBox[{"n", " ", 
            RowBox[{
            "b", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}]}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{"mirrored", " ", "x", " ", "at", " ", "step", " ", "n"}], 
           " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"A", ".", "x"}], " ", "+", " ", "b"}]}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TAt", "[", 
     RowBox[{"t_", ",", " ", "M_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"m", ",", " ", "T", ",", " ", "s", ",", " ", "n"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"Lenght", "@", 
        RowBox[{"BLbiped", "[", 
         RowBox[{"\"\<t\>\"", ",", " ", 
          RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}]}], "]"}]}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"T", " ", "=", " ", 
        RowBox[{
         RowBox[{"M", "[", "\"\<T\>\"", "]"}], "\[LeftDoubleBracket]", "2", 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s", " ", "=", " ", 
        RowBox[{"Mod", "[", 
         RowBox[{"t", ",", " ", "T"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"n", " ", "=", 
        RowBox[{"Quotient", "[", 
         RowBox[{"t", ",", " ", "T"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"T", ",", " ", "s", ",", " ", "n"}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"xAt", "[", 
     RowBox[{"t_", ",", " ", "M_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", " ", "T", ",", " ", "s", ",", " ", "n"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"M", "[", "\"\<x[t]\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", " ", "s", ",", " ", "n"}], "}"}], " ", "=", " ", 
        RowBox[{"TAt", "[", 
         RowBox[{"t", ",", " ", "M"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"xAt", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"x", "[", "s", "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"1", ";;", "nx"}], "\[RightDoubleBracket]"}], ",", " ", "M",
          ",", " ", "n"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"mAt", "[", 
     RowBox[{"t_", ",", " ", "M_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"m", ",", " ", "T", ",", " ", "s", ",", " ", "n"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"t", " ", "=", 
        RowBox[{">", " ", 
         RowBox[{"t", "+"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"M", "[", "\"\<m[t]\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", " ", "s", ",", " ", "n"}], "}"}], " ", "=", " ", 
        RowBox[{"TAt", "[", 
         RowBox[{"t", ",", " ", "M"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"EvenQ", "[", "n", "]"}], ",", " ", 
          RowBox[{"m", "[", "s", "]"}], ",", " ", 
          RowBox[{
           RowBox[{"BLbiped", "[", 
            RowBox[{"\"\<m\>\"", ",", " ", 
             RowBox[{"m", "[", "s", "]"}]}], "]"}], "[", "]"}]}], "]"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"EvenQ", "[", "n", "]"}], ",", " ", 
         RowBox[{
          RowBox[{"BLbiped", "[", 
           RowBox[{"\"\<m\>\"", ",", " ", 
            RowBox[{"m", "[", "s", "]"}]}], "]"}], "[", "]"}], ",", " ", 
         RowBox[{"m", "[", "s", "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cAt", "[", 
    RowBox[{"t_", ",", " ", "M_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "T", ",", " ", "s", ",", " ", "n", ",", " ", "c", ",", " ", "x", ",", 
       " ", "m0", ",", " ", "x0"}], "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"T", ",", " ", "s", ",", " ", "n"}], "}"}], " ", "=", " ", 
       RowBox[{"TAt", "[", 
        RowBox[{"t", ",", " ", "M"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"project", " ", "pre"}], "-", 
        RowBox[{
        "impact", " ", "state", " ", "n", " ", "steps", " ", "ahead"}]}], " ",
        "*)"}], "\[IndentingNewLine]", 
      RowBox[{"x", " ", "=", " ", 
       RowBox[{"xAt", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"M", "[", "\"\<x-\>\"", "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", " ", 
           RowBox[{"1", ";;", "nx"}]}], "\[RightDoubleBracket]"}], ",", " ", 
         "M", ",", " ", "n"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"add", " ", "controls"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"c", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"EvenQ", "[", "n", "]"}], ",", " ", "1", ",", " ", "2"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"c", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"x", ",", " ", 
         RowBox[{
          RowBox[{"M", "[", "\"\<c\>\"", "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"c", ",", " ", 
           RowBox[{
            RowBox[{"nx", "+", "1"}], ";;", "nc"}]}], 
          "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"project", " ", "post"}], "-", 
        RowBox[{"impact", " ", "state", " ", "n"}], "+", 
        RowBox[{"1", " ", "steps", " ", "ahead"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"m0", " ", "=", " ", 
       RowBox[{"mAt", "[", 
        RowBox[{
         RowBox[{"n", " ", "T"}], ",", " ", "M"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x0", " ", "=", " ", 
       RowBox[{"xAt", "[", 
        RowBox[{
         RowBox[{"n", " ", "T"}], ",", " ", "M"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "quick", " ", "hack", " ", "to", " ", "cover", " ", "1", "st", " ", 
        "derivative", " ", "case"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"devec", "[", "\"\<o\>\"", "]"}], " ", "\[Equal]", " ", 
         "0"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"x0", " ", "=", " ", 
          RowBox[{"{", "x0", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"c", " ", "=", " ", 
          RowBox[{"{", "c", "}"}]}], ";"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", " ", "nc", ",", " ", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"x0", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{"x0", ",", " ", 
            RowBox[{"n", "\[LeftDoubleBracket]", 
             RowBox[{"1", ";;", "nx"}], "\[RightDoubleBracket]"}]}], "}"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"c", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{"c", ",", " ", "n"}], "}"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"BLc", "[", 
        RowBox[{"m0", ",", " ", "x0", ",", " ", "c"}], "]"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{"1", ";;", "nc"}], "\[RightDoubleBracket]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[314]:=",ExpressionUUID->"af2dcc1b-5f61-4466-adf1-91bf1f1749f5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLGaitKinematics", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"BLSim", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", "5"}], ",", " ", 
      RowBox[{"\"\<T\>\"", " ", "\[Rule]", " ", "2"}], ",", " ", 
      RowBox[{"\"\<at\>\"", " ", "\[Rule]", " ", "True"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLGaitKinematics", "[", 
    RowBox[{
     RowBox[{"c_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"VectorQ", "[", 
         RowBox[{"#", ",", " ", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"BLGaitKinematics", "[", 
    RowBox[{
     RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}], ",", " ", "c", ",", " ", 
     "opts"}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLGaitKinematics", "[", 
    RowBox[{"m_String", ",", " ", "c_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"BLGaitKinematics", "[", 
    RowBox[{
     RowBox[{"BLSim", "[", 
      RowBox[{"m", ",", " ", "c", ",", " ", 
       RowBox[{"OptionValue", "[", "BLSim", "]"}]}], "]"}], ",", " ", 
     "opts"}], "]"}]}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLGaitKinematics", "[", 
    RowBox[{"\[CurlyPhi]_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", " ", "M", ",", " ", "t", ",", " ", "x", ",", " ", "T", ",", 
       " ", "A", ",", " ", "X", ",", " ", "o", ",", " ", "at"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"M", " ", "=", " ", "\[CurlyPhi]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T", " ", "=", " ", 
       RowBox[{
        RowBox[{"M", "[", "\"\<T\>\"", "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"OptionValue", "[", "\"\<T\>\"", "]"}], 
        "\[RightDoubleBracket]"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"period", " ", "of", " ", "gait"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"at", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<at\>\"", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"AssociationThread", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "\"\<x[t]\>\"", ",", " ", "\"\<c[t]\>\"", ",", " ", 
             "\"\<m[t]\>\""}], "}"}], " ", "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"xAt", ",", " ", "cAt", ",", " ", "mAt"}], "}"}]}], "]"}],
          ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"else", ",", " ", 
           RowBox[{
           "keep", " ", "original", " ", "values", " ", "and", " ", "filter", 
            " ", "time", " ", "stamps"}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"With", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"f", " ", "=", " ", "#"}], "}"}], ",", " ", 
             RowBox[{
              RowBox[{"f", "[", "#", "]"}], "&"}]}], "]"}], "&"}], " ", "/@", 
          " ", 
          RowBox[{"M", "\[LeftDoubleBracket]", 
           RowBox[{"{", 
            RowBox[{
            "\"\<x[t]\>\"", ",", " ", "\"\<c[t]\>\"", ",", " ", 
             "\"\<m[t]\>\""}], "}"}], "\[RightDoubleBracket]"}]}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Assert", "[", 
       RowBox[{
        RowBox[{"n", " ", ">", " ", "0"}], " ", "&&", " ", 
        RowBox[{"IntegerQ", "@", "n"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"x", " ", "=", " ", 
          RowBox[{"M", "[", "k", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"t", " ", "=", " ", 
          RowBox[{"Flatten", "@", 
           RowBox[{"DeleteCases", "[", 
            RowBox[{
             RowBox[{"x", "[", "\"\<Grid\>\"", "]"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"_", "?", "Negative"}], "}"}], ",", " ", 
             RowBox[{"{", "1", "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"t", " ", "=", " ", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"t", " ", "+", " ", 
              RowBox[{"i", " ", "T"}]}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"i", ",", " ", "0", ",", " ", 
               RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"some", " ", "trajectories", " ", 
            RowBox[{"don", "'"}], "t", " ", "have", " ", "t"}], " ", "=", " ",
            "0"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"t", " ", "=", " ", 
          RowBox[{"Prepend", "[", 
           RowBox[{"t", ",", " ", "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"MMA", " ", "bug"}], ",", " ", 
           RowBox[{
            RowBox[{"<|", "|>"}], " ", "below", " ", "should", " ", "get", 
            " ", "rid", " ", "of", " ", "duplicates", " ", "too"}]}], " ", 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"t", " ", "=", " ", 
          RowBox[{"DeleteDuplicates", "[", 
           RowBox[{"t", ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"Norm", "[", 
               RowBox[{"#1", "-", "#2"}], "]"}], " ", "\[LessEqual]", " ", 
              RowBox[{"10", "^", 
               RowBox[{"-", 
                RowBox[{"(*", "12", "*)"}], "6"}]}]}], 
             RowBox[{"(*", 
              RowBox[{"100", "$MachineEpsilon"}], "*)"}], "&"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"X", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"at", "[", "k", "]"}], "[", 
             RowBox[{"#", ",", " ", "M"}], "]"}], "&"}], " ", "/@", " ", 
           "t"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
           "If", " ", "crazy", " ", "interpolation", " ", "values", " ", 
            "appear"}], ",", " ", 
           RowBox[{"like", " ", "with"}]}], " ", "*)"}], 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"Marlo", " ", 
            RowBox[{"rootman", "\[LeftDoubleBracket]", 
             RowBox[{"12", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], ",", 
           " ", 
           RowBox[{"try", " ", "increasing", " ", "multiplier"}]}], " ", 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"to", " ", "$MachineEpsilon", " ", 
           RowBox[{"above", ".", "  ", "Problem"}], " ", "might", " ", "be", 
           " ", "caused"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "by", " ", "time", " ", "stamps", " ", "being", " ", "too", " ", 
           "close", " ", "to", " ", "each", " ", 
           RowBox[{"other", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"o", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"InterpolationOrder", "\[Rule]", 
             RowBox[{"First", "@", 
              RowBox[{"x", "[", "\"\<InterpolationOrder\>\"", "]"}]}]}], ",", 
            " ", 
            RowBox[{"Method", "\[Rule]", 
             RowBox[{"x", "[", "\"\<InterpolationMethod\>\"", "]"}]}]}], 
           "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"M", "[", "k", "]"}], " ", "=", " ", 
          RowBox[{"Interpolation", "[", 
           RowBox[{
            RowBox[{"KeyValueMap", "[", 
             RowBox[{"List", ",", " ", 
              RowBox[{"AssociationThread", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", "t", "}"}], "\[Transpose]"}], " ", "\[Rule]", 
                " ", "X"}], "]"}]}], "]"}], ",", " ", "o"}], "]"}]}], ";"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"k", ",", " ", 
          RowBox[{"{", 
           RowBox[{
           "\"\<x[t]\>\"", ",", " ", "\"\<c[t]\>\"", ",", " ", 
            "\"\<m[t]\>\""}], "}"}]}], "}"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "M"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"faa61ae4-9416-4167-954c-b315a29a51d5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLSimGaitKinematics", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"BLAnimateBiped", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"BLGaitKinematics", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLSimGaitKinematics", "[", 
     RowBox[{
      RowBox[{"c_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"VectorQ", "[", 
          RowBox[{"#", ",", " ", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", 
      " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "M", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"M", " ", "=", " ", 
        RowBox[{"BLGaitKinematics", "[", 
         RowBox[{"c", ",", " ", 
          RowBox[{"OptionValue", "[", "BLGaitKinematics", "]"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"BLAnimateBiped", "[", 
        RowBox[{"M", ",", " ", 
         RowBox[{"OptionValue", "[", "BLAnimateBiped", "]"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLSimGaitKinematics", "[", 
     RowBox[{"m_String", ",", " ", "c_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "M", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"M", " ", "=", " ", 
        RowBox[{"BLGaitKinematics", "[", 
         RowBox[{"m", ",", " ", "c", ",", " ", 
          RowBox[{"OptionValue", "[", "BLGaitKinematics", "]"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"BLAnimateBiped", "[", 
        RowBox[{"M", ",", " ", 
         RowBox[{"OptionValue", "[", "BLAnimateBiped", "]"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLSimGaitKinematics", "[", 
    RowBox[{"\[CurlyPhi]_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "M", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"M", " ", "=", " ", 
       RowBox[{"BLGaitKinematics", "[", 
        RowBox[{"\[CurlyPhi]", ",", " ", 
         RowBox[{"OptionValue", "[", "BLGaitKinematics", "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"BLAnimateBiped", "[", 
       RowBox[{"M", ",", " ", 
        RowBox[{"OptionValue", "[", "BLAnimateBiped", "]"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->"In[323]:=",ExpressionUUID->"c74ccd4b-6eca-4bce-a47d-acce6e65a8c5"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Draw Gait", \
"Section",ExpressionUUID->"b19ae68d-64ea-4c1d-a349-b7fc2cd8b872"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLGetPOI", "[", "c_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"m0", ",", " ", "X", ",", " ", "C"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"m0", " ", "=", " ", 
        RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"X", ",", " ", "C"}], "}"}], " ", "=", " ", 
        RowBox[{
         RowBox[{"BLmxcp", "[", 
          RowBox[{"m0", ",", " ", "c"}], "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"2", ";;", "3"}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"BLGetPOI", "[", 
        RowBox[{"X", ",", " ", "C"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLGetPOI", "[", 
     RowBox[{"x_", ",", " ", "c_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "f", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"f", " ", "=", " ", 
        RowBox[{"BLbiped", "\[LeftDoubleBracket]", 
         RowBox[{"\"\<draw\>\"", ",", " ", "\"\<poi\>\""}], 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"RBDSpatialPosition", "[", 
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ",", 
           " ", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           " ", 
           RowBox[{"\"\<x\>\"", " ", "\[Rule]", " ", "x"}], ",", " ", 
           RowBox[{"\"\<\[Lambda]\>\"", " ", "\[Rule]", " ", "c"}]}], "]"}], 
         "&"}], " ", "/@", " ", "f"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLManifold", "[", "M_Association", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"P", ",", " ", "x", ",", " ", "c", ",", " ", "TcM"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"P", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"BLmxcp", "[", 
           RowBox[{
            RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}], ",", " ", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
           "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"2", ";;", "3"}], "\[RightDoubleBracket]"}], "&"}], " ", "/@",
         " ", "M"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x", " ", "=", " ", 
       RowBox[{"P", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"c", " ", "=", " ", 
       RowBox[{"P", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", "2"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"TcM", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           ".", 
          RowBox[{
          "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
         "&"}], " ", "/@", " ", "M"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"devec", "[", 
          RowBox[{"#", ",", " ", "nx"}], "]"}], "&"}], " ", "/@", " ", 
        "x"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"c", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"devec", "[", 
          RowBox[{"#", ",", " ", "nc"}], "]"}], "&"}], " ", "/@", " ", 
        "c"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"x", " ", "=", " ", 
       RowBox[{"Interpolation", "[", 
        RowBox[{"KeyValueMap", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#1", ",", " ", 
             RowBox[{
             "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             ",", " ", 
             RowBox[{
              RowBox[{
              "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              ".", 
              RowBox[{"TcM", "[", "#1", "]"}]}]}], "}"}], "&"}], ",", " ", 
          "x"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"c", " ", "=", " ", 
       RowBox[{"Interpolation", "[", 
        RowBox[{"KeyValueMap", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#1", ",", " ", 
             RowBox[{
             "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             ",", " ", 
             RowBox[{
              RowBox[{
              "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              ".", 
              RowBox[{"TcM", "[", "#1", "]"}]}]}], "}"}], "&"}], ",", " ", 
          "c"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P", " ", "=", " ", 
       RowBox[{"Interpolation", "[", 
        RowBox[{"KeyValueMap", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#1", ",", " ", 
             RowBox[{
             "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             ",", " ", 
             RowBox[{"TcM", "[", "#1", "]"}]}], "}"}], "&"}], ",", " ", "M"}],
          "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<x[s]\>\"", " ", "\[Rule]", " ", "x"}], ",", " ", 
        RowBox[{"\"\<c[s]\>\"", " ", "\[Rule]", " ", "c"}], ",", " ", 
        RowBox[{"\"\<M[s]\>\"", " ", "\[Rule]", " ", "P"}]}], "|>"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[327]:=",ExpressionUUID->"bf8cac45-2e81-47f7-b2ff-dee952163339"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "BLBoundingBox", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<b\>\"", " ", "\[RuleDelayed]", " ", 
      RowBox[{"BLbiped", "[", "\"\<draw\>\"", "]"}]}], ",", " ", 
     RowBox[{"Padding", " ", "\[Rule]", " ", "4"}], ",", " ", 
     RowBox[{"\"\<t\>\"", " ", "\[Rule]", " ", "Automatic"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLBoundingBox", "[", 
     RowBox[{"\[CurlyPhi]_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"t", ",", " ", "x", ",", " ", "c"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"Lookup", "[", 
         RowBox[{"\[CurlyPhi]", ",", " ", "\"\<x[t]\>\"", ",", " ", 
          RowBox[{"Lookup", "[", 
           RowBox[{"\[CurlyPhi]", ",", " ", "\"\<x[s]\>\"", ",", " ", 
            RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"c", " ", "=", " ", 
        RowBox[{"Lookup", "[", 
         RowBox[{"\[CurlyPhi]", ",", " ", "\"\<c[t]\>\"", ",", " ", 
          RowBox[{"Lookup", "[", 
           RowBox[{"\[CurlyPhi]", ",", " ", "\"\<c[s]\>\"", ",", " ", 
            RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"t", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<t\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"t", " ", "===", " ", "Automatic"}], ",", " ", 
         RowBox[{"t", " ", "=", " ", 
          RowBox[{"Flatten", "@", 
           RowBox[{"x", "[", "\"\<Grid\>\"", "]"}]}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"BLBoundingBox", "[", 
        RowBox[{
         RowBox[{"x", "[", "t", "]"}], ",", " ", 
         RowBox[{"c", "[", "t", "]"}], ",", " ", "opts"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLBoundingBox", "[", 
    RowBox[{"x_", ",", " ", "c_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p", ",", " ", "d", ",", " ", "w"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"d", " ", "=", " ", 
       RowBox[{"Lookup", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<b\>\"", "]"}], ",", " ", 
         "\"\<axes\>\"", ",", " ", "axes"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", " ", "=", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "Padding", "]"}], "  ", 
        RowBox[{
        "widths", "\[LeftDoubleBracket]", "d", "\[RightDoubleBracket]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"d", " ", "=", " ", 
       RowBox[{"d", " ", "+", " ", "mm"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"p", " ", "=", " ", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Values", "@", 
           RowBox[{"First", "@", 
            RowBox[{"LinkPositions", "[", "##", "]"}]}]}], "&"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"x", ",", " ", "c"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"d", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Join", "@@", "p"}], ")"}], "\[Transpose]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Min", " ", "/@", " ", "d"}], ")"}], " ", "-", "  ", "w"}],
          ",", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Max", " ", "/@", " ", "d"}], ")"}], "+", " ", "w"}]}], 
        "}"}], "\[Transpose]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[330]:=",ExpressionUUID->"e8c9905a-c824-4dcb-ae0e-4f3da5128a6b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"BLCreateGridPoints", "[", 
    RowBox[{"T_", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "t", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"get", " ", "interval"}], ",", " ", 
       RowBox[{
       "T", " ", "is", " ", "either", " ", "vector", " ", "of", " ", "points",
         " ", "or", " ", "an", " ", "interpolating", " ", "function"}]}], " ",
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", " ", "=", " ", 
       RowBox[{"MinMax", "@", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"VectorQ", "[", "T", "]"}], ",", " ", "T", ",", " ", 
          RowBox[{"Chop", "@", 
           RowBox[{"T", "[", "\"\<Domain\>\"", "]"}]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", " ", "\[Equal]", " ", "1"}], ",", " ", 
        RowBox[{"t", "\[LeftDoubleBracket]", 
         RowBox[{"1", ";;", "1"}], "\[RightDoubleBracket]"}], ",", " ", 
        RowBox[{"Range", "[", 
         RowBox[{
          RowBox[{"t", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           ",", " ", 
          RowBox[{"t", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
           ",", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
             "t", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "-", 
             RowBox[{
             "t", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            ")"}], "/", 
           RowBox[{"(", 
            RowBox[{"n", "-", "1"}], ")"}]}]}], "]"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLCreateGridPoints", "[", 
     RowBox[{"HoldPattern", "[", 
      RowBox[{"T_", " ", "\[Rule]", " ", "n_"}], "]"}], "]"}], " ", ":=", " ", 
    RowBox[{"BLCreateGridPoints", "[", 
     RowBox[{"T", ",", " ", "n"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLCreateGridPoints", "[", "n_", "]"}], " ", ":=", " ", "n"}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[333]:=",ExpressionUUID->"c987e037-13ad-408e-966e-6e93c1adc458"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLBipedGrid", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", 
       RowBox[{"(", 
        RowBox[{"Automatic", "\[Rule]", " ", "9"}], ")"}]}], ",", " ", 
      RowBox[{"BLDrawBiped", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"ImageSize", " ", "\[Rule]", "  ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"BLLaTex", "[", "\"\<text width\>\"", "]"}], ",", " ", 
         RowBox[{"BLLaTex", "[", "\"\<image height\>\"", "]"}]}], "}"}]}], 
      ",", " ", 
      RowBox[{"BLBoundingBox", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<\[CurlyPhi]\>\"", " ", "\[Rule]", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
          "&"}], ")"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLBipedGrid", "[", 
     RowBox[{"M_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[CurlyPhi]", ",", " ", "x", ",", " ", "c", ",", " ", "n"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "M", " ", "is", " ", "a", " ", "vector", " ", "in", " ", "the", " ",
            "state"}], "-", "time", "-", 
          RowBox[{"control", " ", "space"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"VectorQ", "[", 
          RowBox[{"M", ",", " ", "NumericQ"}], "]"}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"\[CurlyPhi]", " ", "=", " ", 
          RowBox[{"BLSim", "[", "M", "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "M", " ", "is", " ", "a", " ", "pair", " ", "of", " ", 
           "trajectories", " ", 
           RowBox[{"(", 
            RowBox[{
            "manifolds", " ", "have", " ", "interpolation", " ", "errors"}], 
            ")"}]}], " ", "*)"}], " ", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"VectorQ", "[", "M", "]"}], " ", "&&", " ", 
          RowBox[{
           RowBox[{"Length", "@", "M"}], " ", "\[Equal]", " ", "2"}]}], ",", 
         " ", "\[IndentingNewLine]", 
         RowBox[{"\[CurlyPhi]", " ", "=", " ", 
          RowBox[{"AssociationThread", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<x[t]\>\"", ",", " ", "\"\<c[t]\>\""}], "}"}], " ", 
            "\[Rule]", " ", "M"}], "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"M", " ", "is", " ", "a", " ", "trajectory"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"KeyExistsQ", "[", 
          RowBox[{"M", ",", " ", "\"\<x[t]\>\""}], "]"}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"\[CurlyPhi]", " ", "=", " ", "M"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"M", " ", "is", " ", "a", " ", "manifold"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"KeyExistsQ", "[", 
          RowBox[{"M", ",", " ", "\"\<x[s]\>\""}], "]"}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"\[CurlyPhi]", " ", "=", " ", "M"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"M", " ", "is", " ", "a", " ", "manifold", " ", 
           RowBox[{"(", 
            RowBox[{"output", " ", "of", " ", "continuation", " ", "method"}],
             ")"}]}], " ", "*)"}], "\[IndentingNewLine]", "True", ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"\[CurlyPhi]", " ", "=", " ", 
           RowBox[{"BLManifold", "[", "M", "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"Lookup", "[", 
         RowBox[{"\[CurlyPhi]", ",", " ", "\"\<x[t]\>\"", ",", " ", 
          RowBox[{"Lookup", "[", 
           RowBox[{"\[CurlyPhi]", ",", " ", "\"\<x[s]\>\"", ",", " ", 
            RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"c", " ", "=", " ", 
        RowBox[{"Lookup", "[", 
         RowBox[{"\[CurlyPhi]", ",", " ", "\"\<c[t]\>\"", ",", " ", 
          RowBox[{"Lookup", "[", 
           RowBox[{"\[CurlyPhi]", ",", " ", "\"\<c[s]\>\"", ",", " ", 
            RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"n", " ", "=", " ", 
        RowBox[{"BLCreateGridPoints", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"OptionValue", "[", "\"\<n\>\"", "]"}], " ", "/.", " ", 
           RowBox[{"Automatic", " ", "\[Rule]", " ", "x"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"BLBipedGrid", "[", 
        RowBox[{
         RowBox[{"x", "[", "n", "]"}], ",", " ", 
         RowBox[{"c", "[", "n", "]"}], ",", " ", "opts"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BLBipedGrid", "[", 
   RowBox[{
    RowBox[{"x_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"c_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "is", ",", " ", "d", ",", " ", "o", ",", " ", "n", ",", " ", "t0", ",", 
      " ", "tf"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"image", " ", "size"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"is", " ", "=", "  ", 
      RowBox[{"OptionValue", "[", "ImageSize", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"BLDrawBiped", " ", "options"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"d", " ", "=", " ", 
      RowBox[{"BLBoundingBox", "[", 
       RowBox[{"x", ",", " ", "c", ",", " ", 
        RowBox[{"OptionValue", "[", "BLBoundingBox", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"d", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ImageSize", "\[Rule]", " ", "is"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", " ", "d"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"o", " ", "=", " ", 
      RowBox[{"Association", "@", 
       RowBox[{"OptionValue", "[", "BLDrawBiped", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"o", "[", "Graphics", "]"}], " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{"d", ",", " ", 
        RowBox[{"Lookup", "[", 
         RowBox[{"o", ",", " ", "Graphics", ",", " ", 
          RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"o", " ", "=", " ", 
      RowBox[{"Normal", "@", "o"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"d", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "\"\<\[CurlyPhi]\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"create", " ", "grid"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"MapThread", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"BLDrawBiped", "[", 
         RowBox[{"##", ",", " ", 
          RowBox[{"\"\<\[CurlyPhi]\>\"", " ", "\[Rule]", " ", 
           RowBox[{"d", "[", 
            RowBox[{"#2", ",", " ", "c"}], "]"}]}], ",", " ", "o"}], "]"}], 
        "&"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"x", ",", " ", "c"}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[336]:=",ExpressionUUID->"aac6c8bc-6e19-461f-8a55-f1ed9085c2a6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLBipedTimeGridStringFunction", "[", "\"\<Path\>\"", "]"}], " ", 
    ":=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{"#", " ", "\[Equal]", " ", "0"}], ",", " ", 
          "\"\<p = p(0)\>\"", ",", " ", 
          RowBox[{"#", " ", "\[Equal]", " ", "1"}], ",", " ", "\"\<p(1)\>\"", 
          ",", " ", "True", ",", " ", 
          RowBox[{"\"\<p(\>\"", " ", "<>", " ", 
           RowBox[{"ToString", "@", 
            RowBox[{"NumberForm", "[", 
             RowBox[{
              RowBox[{"N", "@", "#"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{"2", ",", "1"}], "}"}]}], "]"}]}], " ", "<>", " ", 
           "\"\<)\>\""}]}], "]"}], "&"}], ")"}], ",", " ", "True"}], "}"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLBipedTimeGridStringFunction", "[", "\"\<ArcLength\>\"", "]"}], 
    " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"#", " ", "\[Equal]", " ", "0"}], ",", " ", 
           "\"\<\\\\alpha = \>\"", ",", " ", "\"\<\>\""}], "]"}], " ", "<>", 
         " ", 
         RowBox[{"ToString", "@", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<\\\\alpha_{``}\>\"", ",", " ", 
            RowBox[{"ToString", "@", 
             RowBox[{"Round", "[", "#", "]"}]}]}], "]"}]}]}], "&"}], ")"}], 
      ",", " ", "False"}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLBipedTimeGridStringFunction", "[", "\"\<Trajectory\>\"", "]"}], 
   " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"#", " ", "\[Equal]", " ", "0"}], ",", " ", 
         "\"\<t = \\\\SI{0}{s}\>\"", ",", " ", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<\\\\SI{``}{s}\>\"", ",", " ", 
           RowBox[{"ToString", "@", 
            RowBox[{"NumberForm", "[", 
             RowBox[{
              RowBox[{"N", "@", "#"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{"3", ",", "3"}], "}"}]}], "]"}]}]}], "]"}]}], "]"}], 
       "&"}], ")"}], ",", " ", "False"}], "}"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
   "BLBipedTimeGridStringFunction", "[", "\"\<SwitchingTime\>\"", "]"}], " ", 
   ":=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"#", " ", "\[Equal]", " ", "0"}], ",", " ", 
         "\"\<t = \\\\SI{0}{s}\>\"", ",", " ", 
         RowBox[{"#", " ", "\[Equal]", " ", "1"}], ",", " ", 
         "\"\<\\\\tau \\\\in \\\\mathbb{R}\>\"", ",", " ", "True", ",", " ", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<\\\\SI{``}{\\\\tau}\>\"", ",", " ", 
           RowBox[{"ToString", "@", 
            RowBox[{"NumberForm", "[", 
             RowBox[{
              RowBox[{"N", "@", "#"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{"3", ",", "3"}], "}"}]}], "]"}]}]}], "]"}]}], "]"}], 
       "&"}], ")"}], ",", " ", "True"}], "}"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[339]:=",ExpressionUUID->"2071aeb5-8298-4af6-9558-a3df5a5b930a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLBipedTimeGrid", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"\"\<d\>\"", " ", "\[Rule]", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "/", "2"}], ",", " ", "3"}], "}"}]}], ","}], " ", 
      "*)"}], 
     RowBox[{
      RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", 
       RowBox[{"(", 
        RowBox[{"Automatic", "\[Rule]", " ", "9"}], ")"}]}], ",", " ", 
      RowBox[{"\"\<T\>\"", " ", "\[Rule]", " ", "\"\<Trajectory\>\""}], ",", 
      " ", 
      RowBox[{"ImageSize", " ", "\[Rule]", " ", 
       RowBox[{"{", 
        RowBox[{"5", 
         RowBox[{"(*", "16", "*)"}], ",", " ", 
         RowBox[{"1", "/", "3"}], ",", " ", 
         RowBox[{"1", "/", "15"}]}], "}"}]}], ",", " ", 
      RowBox[{"BLBipedGrid", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"ImageData", " ", "\[Rule]", " ", "False"}], ",", " ", 
      RowBox[{"ImageCrop", " ", "\[Rule]", " ", "False"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLBipedTimeGrid", "[", 
     RowBox[{"M_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\[CurlyPhi]", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"VectorQ", "[", "M", "]"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[CurlyPhi]", " ", "=", " ", 
          RowBox[{"BLSim", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"BLBipedTimeGrid", "[", 
          RowBox[{
           RowBox[{"\[CurlyPhi]", "[", "\"\<x[t]\>\"", "]"}], ",", " ", 
           RowBox[{"\[CurlyPhi]", "[", "\"\<c[t]\>\"", "]"}], ",", " ", 
           "opts"}], "]"}]}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[CurlyPhi]", " ", "=", " ", 
          RowBox[{"BLManifold", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"BLBipedTimeGrid", "[", 
          RowBox[{
           RowBox[{"\[CurlyPhi]", "[", "\"\<x[s]\>\"", "]"}], ",", " ", 
           RowBox[{"\[CurlyPhi]", "[", "\"\<c[s]\>\"", "]"}], ",", " ", 
           "opts", ",", " ", 
           RowBox[{"\"\<T\>\"", " ", "\[Rule]", " ", "\"\<Path\>\""}]}], 
          "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLBipedTimeGrid", "[", 
    RowBox[{"x_", ",", " ", "c_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", " ", "grid", ",", " ", "arrow", ",", " ", "T", ",", " ", 
       "time", ",", " ", "motion", ",", " ", "o", ",", " ", "n", ",", " ", 
       "ts", ",", " ", "d"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"image", " ", "size"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ts", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", " ", 
         RowBox[{"BLLaTex", "[", "\"\<text width\>\"", "]"}], ",", " ", 
         RowBox[{"BLLaTex", "[", "\"\<image height\>\"", "]"}]}], "}"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ts", " ", "=", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "ImageSize", "]"}], " ", "ts"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"time", " ", "grid", " ", "values"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"t", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"time", " ", "to", " ", "string", " ", "function"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"T", ",", " ", "n"}], "}"}], " ", "=", " ", 
       RowBox[{"BLBipedTimeGridStringFunction", "@", 
        RowBox[{"OptionValue", "[", "\"\<T\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"n", " ", "&&", " ", 
         RowBox[{"VectorQ", "[", "t", "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"create", " ", "time", " ", "grid"}], ",", " ", 
          RowBox[{"make", " ", "sure", " ", "n", " ", 
           RowBox[{"in", " ", "[", 
            RowBox[{"0", ",", " ", "1"}], "]"}], " ", "using", " ", "values", 
           " ", "in", " ", "t"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"MinMax", "[", "t", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"PossibleZeroQ", "[", 
             RowBox[{
              RowBox[{
              "n", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "-", 
              RowBox[{
              "n", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
             "]"}], ",", " ", 
            RowBox[{"{", "0", "}"}], ",", " ", 
            RowBox[{"Chop", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"t", "-", 
                RowBox[{
                "n", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
                ")"}], "/", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                "n", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "-", 
                RowBox[{
                "n", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
                ")"}]}], "]"}]}], "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
        
        RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", "n", 
        ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "create", " ", "time", " ", "grid", " ", "with", " ", "n", " ", 
           RowBox[{"in", " ", "[", 
            RowBox[{"0", ",", " ", "1"}], "]"}], " ", "using", " ", 
           RowBox[{
           "t", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], " ",
           "=", " ", 
          RowBox[{"#", " ", "of", " ", "points"}]}], "  ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"BLCreateGridPoints", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", " ", "1"}], "}"}], ",", " ", 
            RowBox[{
            "t", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
           "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", "True",
         ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"use", " ", "regular", " ", "grid", " ", "points"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"BLCreateGridPoints", "[", 
           RowBox[{"t", " ", "/.", " ", 
            RowBox[{"Automatic", " ", "\[Rule]", " ", "x"}]}], "]"}]}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"time", " ", "list"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"time", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Graphics", "[", 
          RowBox[{
           RowBox[{"BLTeX", "[", 
            RowBox[{
             RowBox[{"T", "[", "s", "]"}], ",", " ", 
             RowBox[{
             "ts", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            "]"}], ",", " ", 
           RowBox[{"ImageSize", "\[Rule]", " ", 
            RowBox[{"ts", "\[LeftDoubleBracket]", 
             RowBox[{"2", ";;", "3"}], "\[RightDoubleBracket]"}]}]}], "]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"s", ",", " ", "n"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"motion", " ", "list"}], ",", " ", 
        RowBox[{
        "use", " ", "our", " ", "time", " ", "grid", " ", "values"}]}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"motion", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "ImageData", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"StringQ", "[", "motion", "]"}], ",", " ", 
        RowBox[{"motion", " ", "=", " ", 
         RowBox[{"BLImportFrom", "[", 
          RowBox[{"\"\<Images\>\"", ",", " ", "motion"}], "]"}]}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"VectorQ", "[", "motion", "]"}], " ", "&&", " ", 
         RowBox[{
          RowBox[{"Length", "@", "motion"}], " ", "\[Equal]", " ", 
          RowBox[{"Length", "@", "time"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"motion", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Image", "[", 
             RowBox[{"#", ",", " ", 
              RowBox[{"Magnification", "\[Rule]", "1"}]}], "]"}], "&"}], " ", 
           "/@", " ", "motion"}]}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"motion", " ", "=", " ", 
          RowBox[{"BLBipedGrid", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", " ", "c"}], "}"}], ",", " ", 
            RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", "t"}], ",", " ", 
            RowBox[{"OptionValue", "[", "BLBipedGrid", "]"}]}], "]"}]}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "ImageCrop", "]"}], ",", " ", 
        RowBox[{"motion", " ", "=", " ", 
         RowBox[{"ImageCrop", " ", "/@", " ", "motion"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Grid", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"time", ",", " ", "motion"}], "}"}], ",", " ", 
        RowBox[{"Frame", "\[Rule]", "All"}], ",", " ", 
        RowBox[{"Dividers", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"Automatic", ",", " ", 
           RowBox[{"Flatten", "@", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Directive", "[", 
                 RowBox[{"Thick", ",", " ", "Black"}], "]"}], ",", " ", 
                "Gray"}], "}"}], ",", " ", "3"}], "]"}]}]}], "}"}]}]}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[343]:=",ExpressionUUID->"f0900d11-8c80-4c8b-83e6-33ed8b06c86f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLBipedFFMPEG", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Duration", " ", "\[Rule]", " ", "4"}], ",", " ", 
      RowBox[{"Directory", " ", "\[Rule]", " ", "\"\<./img/\>\""}], ",", " ", 
      
      RowBox[{"Delete", " ", "\[Rule]", " ", "True"}], ",", " ", 
      RowBox[{"BLBipedGrid", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"BLGaitKinematics", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLBipedFFMPEG", "::", "err"}], " ", "=", " ", 
    "\"\<ffmpeg command did not run successfully, return value ``.\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLBipedFFMPEG", "[", 
     RowBox[{"O_Association", ",", " ", "M_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "N", ",", " ", "A", ",", " ", "i", ",", " ", "m", ",", " ", "a", ",", 
        " ", "c", ",", " ", "G"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"preproces", " ", "O", " ", "so", " ", "that", " ", 
        RowBox[{"it", "'"}], "s", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"c", " ", "index"}], ",", " ", 
          RowBox[{"M", " ", "index"}]}], "}"}], " ", "pair"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"N", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Which", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "@", "#"}], " ", "\[Equal]", " ", "1"}], ",", 
            " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              ",", " ", "1"}], "}"}], ",", " ", "True", ",", " ", "#"}], 
           "]"}], "&"}], " ", "/@", " ", "O"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"A", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"AssociationQ", "[", "M", "]"}], ",", " ", 
          RowBox[{"{", "M", "}"}], ",", " ", "M"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", " ", "m"}], "}"}], " ", "=", " ", 
           RowBox[{"N", "[", "k", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"a", " ", "=", " ", 
           RowBox[{
           "A", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"c", " ", "=", " ", 
           RowBox[{"First", "@", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"VectorQ", "[", "i", "]"}], ",", " ", 
              RowBox[{"a", "[", "i", "]"}], ",", " ", 
              RowBox[{
              "a", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
             "]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"G", " ", "=", " ", 
           RowBox[{"BLGaitKinematics", "[", 
            RowBox[{"c", ",", " ", 
             RowBox[{"OptionValue", "[", "BLGaitKinematics", "]"}]}], "]"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"BLBipedFFMPEG", "[", 
           RowBox[{"k", ",", " ", "G", ",", " ", "opts"}], "]"}]}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"k", ",", " ", 
           RowBox[{"Keys", "@", "N"}]}], "}"}]}], "\[IndentingNewLine]", 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLBipedFFMPEG", "[", 
     RowBox[{"out_String", ",", " ", "\[CurlyPhi]_Association", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"BLBipedFFMPEG", "[", 
     RowBox[{"out", ",", " ", 
      RowBox[{"BLBipedGrid", "[", 
       RowBox[{"\[CurlyPhi]", ",", " ", 
        RowBox[{"OptionValue", "[", "BLBipedGrid", "]"}]}], "]"}], ",", " ", 
      "opts"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLBipedFFMPEG", "[", 
    RowBox[{"out_String", ",", " ", "L_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "d", ",", " ", "n", ",", " ", "fps", ",", " ", "o", ",", " ", "cmd", 
       ",", " ", "m"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"d", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "Directory", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"CreateDirectory", "[", "d", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Length", "@", "L"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m", " ", "=", " ", 
       RowBox[{"IntegerLength", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fps", " ", "=", " ", 
       RowBox[{"n", " ", "/", " ", 
        RowBox[{"OptionValue", "[", "Duration", "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"create", " ", "images", " ", "in", " ", "directory"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"o", " ", "=", " ", 
       RowBox[{"d", " ", "<>", " ", 
        RowBox[{"StringPadLeft", "[", 
         RowBox[{"\"\<1\>\"", ",", " ", "m", ",", " ", "\"\<0\>\""}], "]"}], 
        " ", "<>", " ", "\"\<.jpg\>\""}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Export", "[", 
        RowBox[{"o", ",", " ", "L", ",", "\"\<VideoFrames\>\""}], "]"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"create", " ", ".", "mp4"}], " ", "file", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"yes", " ", "|", " ", "..."}], " ", "=", 
          RowBox[{">", " ", 
           RowBox[{"overwrite", " ", "file"}]}]}], ")"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"o", " ", "=", " ", 
       RowBox[{"out", " ", "<>", " ", "\"\<.mp4\>\""}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cmd", " ", "=", " ", 
       RowBox[{
       "StringTemplate", "[", 
        "\"\<bash -c \\\"yes | ffmpeg -r `` -i ``%0``d.jpg ``\\\"\>\"", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cmd", " ", "=", " ", 
       RowBox[{"Run", "@", 
        RowBox[{"cmd", "[", 
         RowBox[{"fps", ",", " ", "d", ",", " ", "m", ",", " ", "o"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"clean", " ", "up"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "Delete", "]"}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"DeleteFile", "[", "n", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"DeleteDirectory", "[", "d", "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "would", " ", "like", " ", "to", " ", "play", " ", "saved", " ", 
         "vido"}], ",", " ", 
        RowBox[{"but", " ", "Import", " ", "fails"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"cmd", " ", "=!=", " ", "0"}], ",", "  ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"BLBipedFFMPEG", "::", "err"}], ",", " ", "o"}], "]"}], ",",
         " ", 
        RowBox[{"ListAnimate", "[", "L", "]"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[346]:=",ExpressionUUID->"8772b01e-d4fd-4d88-86ca-8009e657b9ab"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "BipedGIF", "]"}], " ", "=", " ", 
   RowBox[{"Prepend", "[", 
    RowBox[{
     RowBox[{"Options", "@", "BipedList"}], ",", " ", 
     RowBox[{"AnimationRepetitions", " ", "\[Rule]", " ", "0"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BipedGIF", "[", 
   RowBox[{"f_", ",", " ", "n_", ",", " ", "c_", ",", " ", "range_", ",", " ", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"g", ",", " ", "N"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"g", " ", "=", " ", 
      RowBox[{"BipedList", "[", 
       RowBox[{"n", ",", " ", "c", ",", " ", "range", ",", " ", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"{", "opts", "}"}], ",", " ", 
          RowBox[{"Options", "@", "BipedList"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"N", " ", "=", " ", 
      RowBox[{"OptionValue", "@", "AnimationRepetitions"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringQ", "@", "f"}], " ", "&&", " ", 
        RowBox[{
         RowBox[{"StringLength", "@", "f"}], " ", ">", " ", "0"}]}], ",", " ", 
       RowBox[{"Export", "[", 
        RowBox[{"f", ",", " ", "g", ",", " ", 
         RowBox[{"\"\<AnimationRepetitions\>\"", " ", "\[Rule]", " ", "N"}]}],
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ListAnimate", "[", 
      RowBox[{"g", ",", " ", 
       RowBox[{"AnimationRepetitions", " ", "\[Rule]", " ", 
        RowBox[{"N", "+", "1"}]}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellLabel->"In[351]:=",ExpressionUUID->"8bd6ef11-854e-4c0f-8098-bf8fa02ddbee"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Draw Indicator Function and Projections", \
"Section",ExpressionUUID->"4bfdd6ac-9fc0-44de-98bd-741cdd2a0fd7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "color", " ", "of", " ", "singular", " ", "and", " ", "regular", " ", 
    "points", " ", "on", " ", "connected", " ", "component"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"RPColor", " ", "=", " ", 
     RowBox[{"RGBColor", "[", 
      RowBox[{"0", ",", 
       RowBox[{"176", "/", "255"}], ",", 
       RowBox[{"80", "/", "255"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SPColor", " ", "=", " ", "Red"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"EPSize", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", "/", "25"}], ",", " ", 
       RowBox[{"1", "/", "35"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"EPLeaderThickness", " ", "=", " ", 
     RowBox[{"1", "/", "200"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"EPCallout", "[", 
      RowBox[{"p_", ",", " ", "g_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "r", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"r", " ", "=", " ", 
         RowBox[{
         "p", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"r", " ", "=", " ", 
         RowBox[{"Which", "[", 
          RowBox[{
           RowBox[{"Negative", "[", "r", "]"}], ",", " ", "Below", ",", " ", 
           RowBox[{"Positive", "[", "r", "]"}], ",", " ", "Above", ",", " ", 
           "True", ",", " ", "Before"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Callout", "[", 
         RowBox[{"p", ",", " ", "g", ",", " ", "r", ",", " ", 
          RowBox[{"Background", "\[Rule]", "None"}], ",", " ", 
          RowBox[{"CalloutStyle", "\[Rule]", 
           RowBox[{"Directive", "[", 
            RowBox[{
             RowBox[{"Thickness", "[", "EPLeaderThickness", "]"}], ",", " ", 
             "Black"}], "]"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SEP", "[", 
      RowBox[{"p_", ",", " ", 
       RowBox[{"ps_:", "Automatic"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "sz", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sz", " ", "=", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ps", " ", "===", " ", "Automatic"}], ",", " ", "EPSize", 
           ",", " ", "ps"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"SPColor", ",", " ", 
          RowBox[{"PointSize", "@", 
           RowBox[{
           "sz", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
          ",", " ", 
          RowBox[{"Point", "[", "p", "]"}], ",", " ", "Black", ",", " ", 
          RowBox[{"PointSize", "@", 
           RowBox[{
           "sz", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
          ",", " ", 
          RowBox[{"Point", "[", "p", "]"}]}], "}"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"REP", "[", 
      RowBox[{"p_", ",", " ", 
       RowBox[{"ps_:", "Automatic"}]}], "]"}], " ", ":=", "  ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "sz", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sz", " ", "=", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ps", " ", "===", " ", "Automatic"}], ",", " ", "EPSize", 
           ",", " ", "ps"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"RPColor", ",", " ", 
          RowBox[{"PointSize", "@", 
           RowBox[{
           "sz", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
          ",", " ", 
          RowBox[{"Point", "[", "p", "]"}], ",", " ", "Black", ",", " ", 
          RowBox[{"PointSize", "@", 
           RowBox[{
           "sz", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
          ",", " ", 
          RowBox[{"Point", "[", "p", "]"}]}], "}"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SEPLine", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Thickness", "[", 
        RowBox[{"2", "/", "200"}], "]"}], ",", " ", "SPColor", ",", " ", 
       RowBox[{"InfiniteLine", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"1", ",", " ", "0"}], "}"}]}], "}"}], "]"}]}], "}"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "BLSingularPointQ", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<P\>\"", " ", "\[Rule]", " ", "BLP"}], ",", " ", 
       RowBox[{"\"\<nstol\>\"", " ", "\[Rule]", " ", "Automatic"}]}], "}"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"BLSingularPointQ", "[", 
      RowBox[{"C_", ",", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"N", ",", " ", "m0", ",", " ", "c0", ",", " ", "h"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m0", " ", "=", " ", 
         RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"c0", " ", "=", " ", 
         RowBox[{
         "C", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"h", " ", "=", " ", 
         RowBox[{
         "C", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"requires", " ", "Jacobian", " ", "to", " ", "exist"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"N", " ", "=", " ", 
         RowBox[{"NullSpace", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"OptionValue", "[", "\"\<P\>\"", "]"}], "[", "c0", "]"}],
             "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", " ", 
           RowBox[{"Tolerance", "\[Rule]", 
            RowBox[{"OptionValue", "[", "\"\<nstol\>\"", "]"}]}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Length", "@", "N"}], " ", ">", " ", 
         RowBox[{"Length", "@", "h"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"3362278a-1fff-4d2c-90f6-12b40c9635ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"compute", " ", "slope"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "\[Sigma]", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<i\>\"", " ", "\[Rule]", " ", "mm"}], ",", " ", 
       RowBox[{"FixAngles", " ", "\[Rule]", " ", 
        RowBox[{"{", "}"}]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Sigma]", "[", 
      RowBox[{"C_List", ",", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"m", ",", " ", "c", ",", " ", "s", ",", " ", "i"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"i", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<i\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"i", " ", "=", " ", 
         RowBox[{"Which", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"IntegerQ", "[", "i", "]"}], ",", " ", "i", ",", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"StringContainsQ", "[", 
            RowBox[{"i", ",", " ", "\"\<x\>\""}], "]"}], ",", " ", "1", ",", 
           " ", "\[IndentingNewLine]", 
           RowBox[{"StringContainsQ", "[", 
            RowBox[{"i", ",", " ", "\"\<y\>\""}], "]"}], ",", " ", "2", ",", 
           " ", "\[IndentingNewLine]", 
           RowBox[{"StringContainsQ", "[", 
            RowBox[{"i", ",", " ", "\"\<z\>\""}], "]"}], ",", " ", "3", ",", 
           "\[IndentingNewLine]", "True", ",", " ", "mm"}], 
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"get", " ", "slope"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"m", " ", "=", " ", 
         RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"c", " ", "=", " ", 
         RowBox[{
         "C", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"s", " ", "=", " ", 
         RowBox[{
          RowBox[{"BLmxcp", "[", 
           RowBox[{"m", ",", " ", "c"}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"2", ";;", "3"}], "\[RightDoubleBracket]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"{", 
          RowBox[{"x", ",", " ", "c"}], "}"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         " ", "=", " ", 
         RowBox[{"devec", "[", 
          RowBox[{
           RowBox[{
           "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           " ", "nx"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"s", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
         " ", "=", " ", 
         RowBox[{"devec", "[", 
          RowBox[{
           RowBox[{
           "s", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
           " ", "nc"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"s", " ", "=", " ", 
         RowBox[{
          RowBox[{"BLAngle", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"BLbiped", "[", 
              RowBox[{"\"\<\[Sigma]\>\"", ",", " ", "m"}], "]"}], "[", 
             RowBox[{
              RowBox[{
              "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              ",", " ", 
              RowBox[{
              "s", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
             "]"}], "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
           "]"}], "/", "Degree"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"c", "\[LeftDoubleBracket]", 
           RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], ",", " ", "s"}], 
         "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Sigma]", "[", 
      RowBox[{"A__Association", ",", " ", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
     RowBox[{"FixAngles", "[", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Sigma]", "[", 
           RowBox[{"#", ",", " ", "opts"}], "]"}], "&"}], ",", " ", 
         RowBox[{"{", "A", "}"}], ",", " ", 
         RowBox[{"{", "2", "}"}]}], "]"}], ",", " ", 
       RowBox[{"OptionValue", "[", "FixAngles", "]"}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[363]:=",ExpressionUUID->"5f334efc-ae18-48ea-8007-2cdd7cb856fb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"qt", "[", 
    RowBox[{"A__Association", ",", " ", 
     RowBox[{"i_Integer:", "2"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "B", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"B", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", " ", "1", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", " ", "i"}], "}"}]}], 
          "\[RightDoubleBracket]"}], "&"}], " ", "/@", " ", 
        RowBox[{"{", "A", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
            " ", 
            RowBox[{
             RowBox[{"BLAngle", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}], "/", "Degree"}]}], "}"}], "&"}], ",", " ", "B", ",", " ", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"FixAngles", "[", "B", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"dbc61366-08de-4d95-9f84-56da7bf6b8e5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"FixAngle", ",", " ", "Listable"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FixAngle", "[", 
     RowBox[{"b_", ",", " ", "a_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s", ",", " ", "d"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"assumes", " ", "angles", " ", "in", " ", "degrees"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"s", " ", "=", " ", 
        RowBox[{"b", " ", "-", " ", "a"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"d", " ", "=", " ", 
        RowBox[{"Abs", "[", "s", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s", " ", "=", " ", 
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"d", " ", ">", " ", "90"}], " ", "&&", " ", 
           RowBox[{"s", " ", ">", " ", "0"}]}], ",", " ", 
          RowBox[{"Ceiling", "[", 
           RowBox[{"s", ",", " ", "180"}], "]"}], ",", " ", 
          RowBox[{"d", " ", ">", " ", "90"}], ",", " ", 
          RowBox[{"Floor", "[", 
           RowBox[{"s", ",", " ", "180"}], "]"}], ",", " ", "True", ",", " ", 
          "0"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"d", " ", "=", " ", 
        RowBox[{"b", "-", "s"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"recurse", " ", "to", " ", "double"}], "-", 
         RowBox[{"check", " ", "d", " ", "is", " ", 
          RowBox[{"w", "/", "i"}], " ", "bounds", " ", "to", " ", "avoid", 
          " ", "edge", " ", "cases"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"s", " ", "\[Equal]", " ", "0"}], ",", " ", "d", ",", " ", 
         RowBox[{"FixAngle", "[", 
          RowBox[{"d", ",", " ", "a"}], "]"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"ex", ".", " ", 
     RowBox[{"FixAngle", "[", 
      RowBox[{
       RowBox[{"-", "26"}], ",", " ", "155"}], "]"}]}], " ", "leads", " ", 
    "to", " ", "334", " ", "not", " ", "154", " ", 
    RowBox[{"w", "/", "o"}], " ", "recursion"}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "FixAngles", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<K\>\"", " ", "\[Rule]", " ", "1"}], ",", " ", 
      RowBox[{"\"\<V\>\"", " ", "\[Rule]", " ", "2"}], ",", " ", 
      RowBox[{"\"\<a\>\"", " ", "\[Rule]", " ", "Automatic"}]}], "}"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FixAngles", "[", 
     RowBox[{
      RowBox[{"{", "A__Association", "}"}], ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"FixAngles", "[", 
     RowBox[{"A", ",", " ", "opts"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FixAngles", "[", 
   RowBox[{"A__Association", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "M", ",", " ", "f", ",", " ", "s", ",", " ", "k", ",", " ", "v", ",", 
      " ", "\[Theta]", ",", " ", "z"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"k", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "\"\<K\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"v", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "\"\<V\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"z", " ", "=", " ", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"{", "}"}], ",", " ", "v", ",", " ", "0"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"get", " ", "walking", " ", "slope"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"M", " ", "=", " ", "a"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"fix", " ", "angles"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"f", " ", "=", " ", 
         RowBox[{"Select", "[", 
          RowBox[{
           RowBox[{"Keys", "@", "M"}], ",", " ", 
           RowBox[{
            RowBox[{"Positive", "@", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}]}], 
            "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Theta]", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<a\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"\[Theta]", " ", "===", " ", "Automatic"}], ",", " ", 
          RowBox[{"\[Theta]", " ", "=", " ", 
           RowBox[{
            RowBox[{"Lookup", "[", 
             RowBox[{"a", ",", " ", 
              RowBox[{"Key", "@", 
               RowBox[{"{", "0", "}"}]}], ",", " ", "z"}], "]"}], 
            "\[LeftDoubleBracket]", "v", "\[RightDoubleBracket]"}]}]}], "]"}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"M", "[", "i", "]"}], " ", "=", " ", 
            RowBox[{"ReplacePart", "[", 
             RowBox[{
              RowBox[{"M", "[", "i", "]"}], ",", " ", 
              RowBox[{"v", " ", "\[Rule]", " ", 
               RowBox[{"FixAngle", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"M", "[", "i", "]"}], "\[LeftDoubleBracket]", "v", 
                  "\[RightDoubleBracket]"}], ",", " ", "\[Theta]"}], 
                "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"\[Theta]", " ", "=", " ", 
            RowBox[{
             RowBox[{"M", "[", "i", "]"}], "\[LeftDoubleBracket]", "v", 
             "\[RightDoubleBracket]"}]}], ";"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"i", ",", " ", "f"}], "}"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"f", " ", "=", " ", 
         RowBox[{"Select", "[", 
          RowBox[{
           RowBox[{"Keys", "@", "M"}], ",", " ", 
           RowBox[{
            RowBox[{"Negative", "@", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}]}], 
            "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Theta]", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<a\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"\[Theta]", " ", "===", " ", "Automatic"}], ",", " ", 
          RowBox[{"\[Theta]", " ", "=", " ", 
           RowBox[{
            RowBox[{"Lookup", "[", 
             RowBox[{"a", ",", " ", 
              RowBox[{"Key", "@", 
               RowBox[{"{", "0", "}"}]}], ",", " ", "z"}], "]"}], 
            "\[LeftDoubleBracket]", "v", "\[RightDoubleBracket]"}]}]}], "]"}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"M", "[", "i", "]"}], " ", "=", " ", 
            RowBox[{"ReplacePart", "[", 
             RowBox[{
              RowBox[{"M", "[", "i", "]"}], ",", " ", 
              RowBox[{"v", " ", "\[Rule]", " ", 
               RowBox[{"FixAngle", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"M", "[", "i", "]"}], "\[LeftDoubleBracket]", "v", 
                  "\[RightDoubleBracket]"}], ",", " ", "\[Theta]"}], 
                "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"\[Theta]", " ", "=", " ", 
            RowBox[{
             RowBox[{"M", "[", "i", "]"}], "\[LeftDoubleBracket]", "v", 
             "\[RightDoubleBracket]"}]}], ";"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"i", ",", " ", "f"}], "}"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "M"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"a", ",", " ", 
         RowBox[{"{", "A", "}"}]}], "}"}]}], "\[IndentingNewLine]", "]"}]}]}],
    "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"68899a55-b62f-40b9-82a8-dfa456196a9b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLPlotProjection", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Projection", " ", "\[Rule]", " ", "2"}], ",", " ", 
      RowBox[{"ListPlot", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"BLSingularPointQ", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"Magnification", " ", "\[Rule]", " ", "5"}], ",", " ", 
      RowBox[{"FrameStyle", " ", "\[Rule]", " ", "18"}], ",", " ", 
      RowBox[{"Callout", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"PointSize", " ", "\[Rule]", " ", "EPSize"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLPlotProjection", "[", 
     RowBox[{
      RowBox[{"{", "A__Association", "}"}], ",", " ", "o___"}], "]"}], " ", ":=",
     " ", 
    RowBox[{"BLPlotProjection", "[", 
     RowBox[{"A", ",", " ", "o"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLPlotProjection", "[", 
    RowBox[{"A__Association", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "B", ",", " ", "e", ",", " ", "AP", ",", " ", "BP", ",", " ", "lb", ",",
        " ", "o", ",", " ", "ps", ",", " ", "mag"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "Projection", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"IntegerQ", "@", "e"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"B", " ", "=", " ", 
          RowBox[{"qt", "[", 
           RowBox[{"A", ",", " ", "e"}], "]"}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"lb", " ", "=", " ", 
          RowBox[{"ToString", "@", 
           RowBox[{"StringForm", "[", 
            RowBox[{
            "\"\<q_`` \\\\; \\\\text{(joint angle)}\>\"", ",", " ", "e"}], 
            "]"}]}]}]}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"B", " ", "=", " ", 
          RowBox[{"\[Sigma]", "[", 
           RowBox[{"A", ",", " ", 
            RowBox[{"\"\<i\>\"", " ", "\[Rule]", " ", "e"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
         "lb", " ", "=", " ", "\"\<\\\\sigma \\\\; \\\\text{(slope)}\>\""}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"lb", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
        "\"\<\\\\tau \\\\; \\\\text{(switching time)}\>\"", ",", " ", "lb"}], 
        "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"format", " ", "data"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"AP", " ", "=", " ", 
       RowBox[{"DeleteMissing", "@", 
        RowBox[{"Lookup", "[", 
         RowBox[{
          RowBox[{"{", "A", "}"}], ",", " ", 
          RowBox[{"Key", "@", 
           RowBox[{"{", "0", "}"}]}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"BP", " ", "=", " ", 
       RowBox[{"DeleteMissing", "@", 
        RowBox[{"Lookup", "[", 
         RowBox[{"B", ",", " ", 
          RowBox[{"Key", "@", 
           RowBox[{"{", "0", "}"}]}]}], "]"}]}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "mark", " ", "initial", " ", "points", " ", "as", " ", "regular", " ", 
        "or", " ", "singular", " ", "points"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"e", " ", "=", " ", 
       RowBox[{
        RowBox[{"BLSingularPointQ", "[", 
         RowBox[{"#", ",", " ", 
          RowBox[{"OptionValue", "@", "BLSingularPointQ"}]}], "]"}], "&"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"e", " ", "=", " ", 
       RowBox[{"e", " ", "/@", " ", "AP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"add", " ", "branch", " ", "of", " ", 
        RowBox[{"EPs", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"AP", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Or", "@@", "e"}], ",", " ", "SEPLine", ",", " ", 
         RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"add", " ", "REPs", " ", "and", " ", "SEPs"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"ps", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "PointSize", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"VectorQ", "[", "ps", "]"}], ",", " ", 
        RowBox[{"ps", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{"ps", ",", " ", "ps"}], "}"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"e", " ", "=", " ", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"#1", ",", " ", 
            RowBox[{"SEP", "[", 
             RowBox[{"#2", ",", " ", 
              RowBox[{
              "ps", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
             "]"}], ",", " ", 
            RowBox[{"REP", "[", 
             RowBox[{"#2", ",", " ", 
              RowBox[{
              "ps", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
             "]"}]}], "]"}], "&"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"e", ",", " ", "BP"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"add", " ", "callouts"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"o", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"BP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "Callout", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"o", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"PossibleZeroQ", "@", 
               RowBox[{"Norm", "[", "j", "]"}]}], ",", " ", 
              RowBox[{"{", "}"}], ",", " ", 
              RowBox[{"REP", "[", 
               RowBox[{
                RowBox[{"B", "\[LeftDoubleBracket]", 
                 RowBox[{"i", ",", " ", 
                  RowBox[{"Key", "@", "j"}]}], "\[RightDoubleBracket]"}], ",",
                 " ", 
                RowBox[{
                "ps", "\[LeftDoubleBracket]", "2", 
                 "\[RightDoubleBracket]"}]}], "]"}]}], "]"}], ",", " ", "o"}],
            "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"B", "\[LeftDoubleBracket]", 
           RowBox[{"i", ",", " ", 
            RowBox[{"Key", "@", "j"}]}], "\[RightDoubleBracket]"}], " ", "=", 
          " ", 
          RowBox[{"EPCallout", "[", 
           RowBox[{
            RowBox[{"B", "\[LeftDoubleBracket]", 
             RowBox[{"i", ",", " ", 
              RowBox[{"Key", "@", "j"}]}], "\[RightDoubleBracket]"}], ",", 
            " ", 
            RowBox[{"BP", "[", 
             RowBox[{"i", ",", "j"}], "]"}]}], "]"}]}]}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", 
          RowBox[{"Keys", "@", "BP"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"j", ",", " ", 
          RowBox[{"Keys", "@", 
           RowBox[{"BP", "[", "i", "]"}]}]}], "}"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"e", " ", "=", " ", 
       RowBox[{"Flatten", "@", 
        RowBox[{"{", 
         RowBox[{"e", ",", " ", "o"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"format", " ", "plot"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"mag", " ", "=", " ", 
       RowBox[{"OptionValue", "@", "Magnification"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"NumericQ", "[", "mag", "]"}], ",", " ", 
        RowBox[{"mag", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{"mag", ",", " ", 
           RowBox[{"0.5", "mag"}]}], "}"}]}]}], "]"}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"for", " ", "backwards", " ", "compatibility"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"lb", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"BLTeX", "[", 
          RowBox[{"#", ",", 
           RowBox[{
           "mag", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
          "]"}], "&"}], " ", "/@", " ", "lb"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"o", " ", "=", " ", 
       RowBox[{"<|", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"FrameLabel", " ", "\[Rule]", " ", "lb"}], ",", " ", 
          RowBox[{"Prolog", " ", "\[Rule]", " ", "AP"}], ",", " ", 
          RowBox[{"Epilog", " ", "\[Rule]", " ", "e"}], ",", " ", 
          RowBox[{"FrameStyle", "\[Rule]", 
           RowBox[{"Directive", "[", 
            RowBox[{"Black", ",", " ", 
             RowBox[{"OptionValue", "@", "FrameStyle"}]}], "]"}]}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", " ", 
           RowBox[{"Directive", "[", 
            RowBox[{
             RowBox[{"Thickness", "[", 
              RowBox[{"1.5", "/", "200"}], "]"}], ",", " ", "RPColor"}], 
            "]"}]}], ",", " ", 
          RowBox[{"ImageSize", "\[Rule]", 
           RowBox[{"BLLaTex", "[", "\"\<text width\>\"", "]"}]}]}], "}"}], 
        "|>"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"o", " ", "=", " ", 
       RowBox[{"Normal", "@", 
        RowBox[{"Join", "[", 
         RowBox[{"o", ",", " ", 
          RowBox[{"<|", 
           RowBox[{"OptionValue", "[", "ListPlot", "]"}], "|>"}]}], "]"}]}]}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"extract", " ", "data"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Values", "@", 
          RowBox[{"KeySort", "@", "#"}]}], "&"}], " ", "/@", " ", "B"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"BLFramePlot", "[", 
       RowBox[{"B", ",", " ", 
        RowBox[{"ListPlot", "\[Rule]", " ", "o"}], ",", " ", 
        RowBox[{"Format", " ", "\[Rule]", " ", 
         RowBox[{"BLFormatPlot", "[", 
          RowBox[{
          "mag", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
          "]"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True,
 CellLabel->
  "In[372]:=",ExpressionUUID->"073c3475-a3fc-431e-9f9d-b32f74034537"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "might", " ", "need", " ", "to", " ", "be", " ", "updated", " ", "to", " ",
     "work", " ", "with", " ", "new", " ", "FramePlot"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"PlotIndicatorFunction", "[", 
     RowBox[{"root_", ",", " ", "t_", ",", " ", 
      RowBox[{"tmax_:", "Automatic"}], ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "FindRoot", "]"}]}]}], "]"}], " ", ":=",
     " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"T", ",", " ", "IF", ",", " ", "TD"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", " ", "IF", ",", " ", "TD"}], "}"}], " ", "=", " ", 
        
        RowBox[{"FindBifurcation", "[", 
         RowBox[{"root", ",", " ", "t", ",", " ", "tmax", ",", " ", "opts"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"T", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", " ", "0"}], "}"}], "&"}], " ", "/@", " ", 
         "T"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"FramePlot", "[", 
        RowBox[{"TD", ",", " ", 
         RowBox[{"\"\<sp\>\"", " ", "\[Rule]", " ", "T"}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<tstr\>\"", " ", "\[Rule]", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"StringForm", "[", 
              RowBox[{"\"\<`` s\>\"", ",", " ", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"PossibleZeroQ", "@", "#"}], ",", " ", "0", ",", " ", 
                 RowBox[{"NumberForm", "[", 
                  RowBox[{"#", ",", " ", "2"}], "]"}]}], "]"}]}], "]"}], 
             "&"}], ",", " ", 
            RowBox[{
             RowBox[{"StringForm", "[", 
              RowBox[{"\"\<``\>\"", ",", " ", 
               RowBox[{"ScientificForm", "[", 
                RowBox[{"#", ",", " ", 
                 RowBox[{"{", 
                  RowBox[{"3", ",", "2"}], "}"}]}], "]"}]}], "]"}], "&"}]}], 
           "}"}]}], ",", " ", 
         RowBox[{"\"\<lbl\>\"", " ", "\[Rule]", " ", 
          RowBox[{"{", 
           RowBox[{
           "\"\<T (switching time, s)\>\"", ",", " ", "\"\<IF(T)\>\""}], 
           "}"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[375]:=",ExpressionUUID->"55626226-c295-4d7d-8d15-36cf1904b9fd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "BLFormatPlot", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Magnification", " ", "\[Rule]", " ", "1"}], ",", " ", 
     RowBox[{"NumberForm", " ", "\[Rule]", " ", 
      RowBox[{"{", 
       RowBox[{"3", ",", " ", "1"}], "}"}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLFormatPlot", "[", 
    RowBox[{
     RowBox[{"mag_:", "1"}], ",", " ", 
     RowBox[{"nf_:", 
      RowBox[{"{", 
       RowBox[{"3", ",", "1"}], "}"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"BLTeX", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"#", " ", "\[Equal]", " ", "0"}], ",", " ", 
           "\"\<\\\\SI{0}{s}\>\"", ",", " ", 
           RowBox[{"StringForm", "[", 
            RowBox[{"\"\<\\\\SI{``}{s}\>\"", ",", " ", 
             RowBox[{"ToString", "@", 
              RowBox[{"NumberForm", "[", 
               RowBox[{
                RowBox[{"N", "@", "#"}], ",", " ", "nf"}], "]"}]}]}], "]"}]}],
           "]"}], ",", " ", "mag"}], "]"}], "&"}], ")"}], ",", " ", 
     RowBox[{
      RowBox[{"BLTeX", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ToString", "@", 
          RowBox[{"Round", "@", "#"}]}], " ", "<>", " ", 
         "\"\<^\\\\circ\>\""}], ",", " ", "mag"}], "]"}], "&"}]}], "}"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLFramePlot", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Format", " ", "\[Rule]", " ", 
       RowBox[{"BLFormatPlot", "[", "]"}]}], ",", " ", 
      RowBox[{"ListPlot", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"Ticks", "\[Rule]", " ", "Automatic"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLFramePlot", "[", 
     RowBox[{"G_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "plot", ",", " ", "ft", ",", " ", "o", ",", " ", "ticks", ",", " ", 
        "f"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"plot", " ", "=", " ", 
        RowBox[{"ListPlot", "[", 
         RowBox[{"G", ",", " ", 
          RowBox[{"Joined", "\[Rule]", " ", "True"}], ",", " ", 
          RowBox[{"Ticks", "\[Rule]", " ", 
           RowBox[{"OptionValue", "[", "Ticks", "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"get", " ", "x"}], "-", " ", 
         RowBox[{"and", " ", "y"}], "-", 
         RowBox[{
         "coordinate", " ", "tick", " ", "marks", " ", "and", " ", "relabel", 
          " ", "major", " ", "tick", " ", "marks"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ticks", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "Format", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ft", " ", "=", " ", 
        RowBox[{"Ticks", " ", "/.", " ", 
         RowBox[{"First", "@", 
          RowBox[{"AbsoluteOptions", "[", 
           RowBox[{"plot", ",", " ", "Ticks"}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"f", " ", "=", " ", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"NumericQ", "[", 
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "]"}], ",", " ", 
           RowBox[{"Insert", "[", 
            RowBox[{
             RowBox[{"Delete", "[", 
              RowBox[{"#1", ",", " ", "2"}], "]"}], ",", " ", 
             RowBox[{"#2", "[", 
              RowBox[{
              "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}], ",", " ", "2"}], "]"}], ",", " ", "#"}], "]"}], "&"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
           "ft", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], " ", 
           "=", " ", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{
             "ft", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
             ",", " ", 
             RowBox[{
              RowBox[{"NumericQ", "[", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "]"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "ft", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], " ", 
           "=", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"f", "[", 
              RowBox[{"#", ",", " ", 
               RowBox[{
               "ticks", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}]}], "]"}], "&"}], " ", "/@", " ", 
            RowBox[{
            "ft", "\[LeftDoubleBracket]", "i", 
             "\[RightDoubleBracket]"}]}]}]}], ",", "\[IndentingNewLine]", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", 
           RowBox[{"Length", "@", "ft"}]}], "}"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"ft", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
            "ft", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",",
             " ", "None"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
            "ft", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",",
             " ", "None"}], "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", "plot", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"o", " ", "=", " ", 
        RowBox[{"Sequence", "[", 
         RowBox[{
          RowBox[{"Frame", "\[Rule]", "True"}], ",", " ", 
          RowBox[{"Axes", " ", "\[Rule]", " ", "False"}], ",", " ", 
          RowBox[{"FrameTicks", " ", "\[Rule]", " ", "ft"}], ",", " ", 
          RowBox[{"OptionValue", "[", "ListPlot", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"ListPlot", "[", 
        RowBox[{"G", ",", " ", 
         RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", "o"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"[", "1", "]"}], " ", 
     RowBox[{"http", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
        "questions"}], "/", "19859"}], "/", "plot"}], "-", "extract", "-", 
     "data", "-", "to", "-", "a", "-", "file"}]}], " ", "*)"}]}]}], "Input",
 InitializationCell->True,
 CellLabel->"In[376]:=",ExpressionUUID->"f7d0386e-a28f-408c-8fea-768cf354e284"]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section",
 InitializationCell->
  True,ExpressionUUID->"5be3e160-d4ee-4dd4-b8c2-d217fd1851a5"],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\n", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellLabel->"In[380]:=",ExpressionUUID->"5e082c0a-0c33-4813-ba53-955e56d37b43"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
Evaluator->"Local",
WindowSize->{1247, 1383},
WindowMargins->{{0, Automatic}, {0, Automatic}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
CellContext->"Global`",
TrackCellChangeTimes->False,
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]

